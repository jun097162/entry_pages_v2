<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>フロー1：基礎情報</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 14px;
    line-height: 1.5;
    color: #333;
    background-color: #f8f9fa;
    padding: 20px;
}
.container {
    max-width: 900px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 4px;
}
h1, h2 {
    color: #333;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 20px;
}
h2 {
    font-size: 1.2em;
    margin-top: 30px;
}
h3 {
    font-size: 1.1em;
    margin-top: 20px;
    margin-bottom: 10px;
    padding-bottom: 5px;
    border-bottom: 1px dotted #ccc;
}
h4 { /* Added for sub-sections like 利用交通機関詳細 */
    font-size: 1.05em;
    margin-top: 15px;
    margin-bottom: 10px;
    color: #555;
}
.form-section {
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #eee;
}
.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}
.form-group {
    margin-bottom: 15px;
    position: relative; /* For suggestion box positioning */
}
.form-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 5px;
}
.form-group input[type="text"],
.form-group input[type="tel"],
.form-group input[type="email"],
.form-group input[type="date"],
.form-group input[type="number"],
.form-group input[type="file"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
}
.form-group input[type="file"] {
    padding: 3px 8px;
}
textarea {
    min-height: 80px;
    resize: vertical;
}
.inline-fields {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}
.inline-fields .form-group {
    flex: 1;
    min-width: 200px;
}
.postal-code-group {
    display: flex;
    align-items: flex-end;
    gap: 10px;
}
.postal-code-group .form-group {
    flex-grow: 1;
}
.postal-code-group button {
    padding: 8px 12px;
    font-size: 0.9em;
    height: 35px;
    flex-shrink: 0;
    margin-bottom: 15px;
}
.radio-group label,
.checkbox-group label {
    font-weight: normal;
    margin-right: 15px;
}
.radio-group input[type="radio"],
.checkbox-group input[type="checkbox"] {
    margin-right: 5px;
    vertical-align: middle;
}
.readonly-field {
    background-color: #e9ecef;
    cursor: not-allowed;
}
.required-field {
    border: 1px solid red;
    background-color: #fff0f0;
}
.description, .note, .file-status {
    font-size: 0.9em;
    color: #666;
    margin-top: 5px;
}
.annotation {
     /* ... existing styles ... */
}
.document-box {
    border: 1px dashed #ccc;
    padding: 15px;
    text-align: center;
    margin: 10px 0;
    background-color: #f9f9f9;
    flex: 1;
    min-width: 200px;
    position: relative;
}
.document-box.clickable-document {
    cursor: pointer;
    transition: background-color 0.2s;
}
.document-box.clickable-document:hover {
    background-color: #f0f0f0;
}
.document-box p {
    margin: 5px 0;
}
.document-icon {
    font-size: 2em;
    color: #007bff;
}
.upload-button-placeholder, .action-button-style {
    display: inline-block;
    padding: 8px 12px;
    background-color: #007bff;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    border: none;
    text-align: center;
}
.upload-button-placeholder:hover, .action-button-style:hover {
    background-color: #0056b3;
}
.modal-trigger-link {
    color: #007bff;
    text-decoration: underline;
    cursor: pointer;
}
.conditions {
    border: 1px solid #007bff;
    padding: 15px;
    margin-top: 10px;
    background-color: #e7f3ff;
    border-radius: 4px;
}
.conditions ul {
    padding-left: 20px;
    margin: 0;
}
.conditions li {
    margin-bottom: 5px;
}
.checkbox-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 10px;
}
.checkbox-list .checkbox-group {
    display: flex;
    align-items: center;
}
.checkbox-list .checkbox-group .upload-icon-placeholder {
    margin-left: auto;
    font-size: 0.8em;
    color: #007bff;
    cursor: pointer;
}

/* Suggestion Box Styles */
.suggestion-box {
    display: none;
    position: absolute;
    background-color: white;
    border: 1px solid #ccc;
    border-top: none;
    z-index: 100;
    width: calc(100% - 2px);
    max-height: 150px;
    overflow-y: auto;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    box-sizing: border-box;
    left: 0;
    top: 100%;
}
.suggestion-box div {
    padding: 8px;
    cursor: pointer;
}
.suggestion-box div:hover {
    background-color: #f0f0f0;
}
.file-upload-status-container {
    margin-top: 5px;
    display: flex;
    align-items: center;
    justify-content: center; /* Center items if they wrap */
    gap: 5px;
}
.delete-file-btn {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 3px 7px;
    font-size: 0.8em;
    border-radius: 3px;
    cursor: pointer;
    line-height: 1; /* Ensure consistent height */
}
.delete-file-btn:hover {
    background-color: #c82333;
}


/* Modal Styles (Shared) */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
    align-items: center; 
    justify-content: center;
}
.modal-content {
    background-color: #fefefe;
    margin: auto; 
    padding: 25px; 
    border: 1px solid #888;
    width: 80%;
    max-width: 600px; 
    border-radius: 8px;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

/* General styles for modal header, applicable to all modals using this structure */
.modal-header {
    padding-bottom: 15px;
    border-bottom: 1px solid #e9ecef;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 1.4em; 
    color: #333;
    border-bottom: none;
}

/* General modal close button style */
.modal .close-button { 
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1; 
    padding: 0 5px; 
}
.modal .close-button:hover,
.modal .close-button:focus {
    color: black;
    text-decoration: none;
}

/* Contract Agreement Modal Specific Styles */
.contract-agreement-modal .modal-content { /* Specific overrides for contract modals */
    padding: 25px 30px; 
    max-width: 900px; 
}
.contract-agreement-modal .modal-body .form-group { margin-bottom: 20px; }
.contract-agreement-modal .modal-body label { display: block; font-size: 14px; font-weight: bold; color: #333; margin-bottom: 8px; }
.contract-agreement-modal .modal-body input[type="text"],
.contract-agreement-modal .modal-body textarea { width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; box-sizing: border-box; font-size: 14px; }
.contract-agreement-modal .modal-body textarea { min-height: 100px; resize: vertical; }
.contract-agreement-modal .modal-body .required-label { background-color: #fd7e14; color: white; padding: 2px 6px; font-size: 10px; border-radius: 3px; margin-left: 5px; }
.contract-agreement-modal .modal-footer { padding-top: 20px; border-top: 1px solid #e9ecef; margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px; }
.contract-agreement-modal .modal-footer .btn-secondary { background-color: #f8f9fa; color: #333; border: 1px solid #ced4da; }
.contract-agreement-modal .error-message { display: block; color: #dc3545; font-size: 12px; margin-top: 4px; }
.contract-agreement-modal .input-error { border-color: #dc3545 !important; }
.contract-agreement-modal .agree-modal-body .checkbox-group { margin-bottom: 15px; display: flex; align-items: center; }
.contract-agreement-modal .agree-modal-body input[type="checkbox"] { margin-right: 10px; transform: scale(1.1); }

.contract-viewer {
    border: 1px solid #ccc; border-radius: 6px; padding: 10px; margin-bottom: 15px;
    background-color: #fff; overflow-x: auto; max-height: 400px; overflow-y: auto;
}
.contract-viewer img { max-width: 100%; height: auto; display: block; margin: 0 auto; }
.action-prompt {  text-align: center; font-size: 14px; color: #555; margin-bottom: 15px; }
.button-group {  display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; }
.action-btn {
    padding: 10px 25px; font-size: 15px; border: none; border-radius: 5px;
    cursor: pointer; font-weight: bold; transition: background-color 0.3s, box-shadow 0.3s, opacity 0.3s;
}
.agree-btn { background-color: #007bff; color: white; }
.reject-btn { background-color: #f8f9fa; color: #dc3545; border: 1px solid #dc3545; }
.reject-btn.submit { background-color: #dc3545; color: white; }

.post-agreement-actions-modal {
    display: none; flex-direction: column; align-items: center; gap: 10px; margin-top: 15px;
}
.action-buttons-row-inner { display: flex; justify-content: center; gap: 10px; }
.action-btn-small {
    padding: 8px 15px; font-size: 14px; border: 1px solid #ccc; background-color: #fff;
    color: #333; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; gap: 5px;
}
.action-btn-small svg { width: 1em; height: 1em; fill: currentColor; }
.post-agreement-actions-modal .checkbox-option { display: flex; align-items: center; font-size: 14px; }
.post-agreement-actions-modal .checkbox-option input[type="checkbox"] { margin-right: 5px; }
.document-box-post-actions { margin-top: 10px; display: flex; justify-content: center; gap: 10px; }
.image-preview-container { display: flex; align-items: flex-start; gap: 20px; }
.image-preview-container .form-group { flex: 1; }
.image-preview-box {
    width: 200px; height: 150px; border: 2px dashed #ccc; display: flex;
    justify-content: center; align-items: center; text-align: center;
    color: #777; background-color: #f9f9f9; overflow: hidden;
}
.image-preview-box img { max-width: 100%; max-height: 100%; display: block; }
.commute-method-specific-section {
    border: 1px solid #e0e0e0; padding: 15px; margin-top: 15px;
    border-radius: 4px; background-color: #fdfdfd;
}
.contract-status { font-weight: bold; }
.status-agreed { color: green; }
.status-pending { color: orange; }
.status-rejected { color: red; }

.work-history-entry {
    border: 1px solid #e0e0e0; padding: 15px; margin-bottom: 15px;
    border-radius: 4px; background-color: #fdfdfd;
}
.work-history-header {
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
}
.work-history-header h3 { margin-top: 0; margin-bottom: 0; border-bottom: none; }
.delete-work-history-btn {
    background-color: #dc3545; color: white; border: none; padding: 5px 10px;
    border-radius: 4px; font-size: 0.85em; cursor: pointer;
}
.delete-work-history-btn:hover { background-color: #c82333; }

.debug-controls {
    background-color: #f0f0f0;
    padding: 10px;
    margin-bottom: 20px;
    text-align: center;
    border: 1px solid #ddd;
    border-radius: 4px;
}
.debug-controls button {
    background-color: #6c757d;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    margin: 0 5px;
}
.debug-controls button:hover {
    background-color: #5a6268;
}
.navigation-buttons {
    display: flex;
    justify-content: space-between;
    margin-top: 30px;
}
.navigation-buttons .action-button-style {
    padding: 10px 20px;
    font-size: 1.1em;
}
.navigation-buttons .next-btn {
    background-color: #007bff;
}
.navigation-buttons .prev-btn {
    background-color: #6c757d;
}
.navigation-buttons .submit-btn {
    background-color: #28a745;
}
        /* ページタイトルスタイルを統一 */
        h1 {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            color: #0056b3;
            font-size: 1.8em;
            margin-bottom: 1.5rem;
        }
        .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 6px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .file-upload-area.dragover {
            border-color: #007bff;
            background-color: #f0f8ff;
        }
        .file-upload-area p { margin: 0; color: #555; }
        .file-upload-area .browse-link { color: #007bff; text-decoration: underline; }
        #file-info { margin-top: 1rem; font-size: 0.9rem; }
        .file-info-header, .file-info-row { display: flex; justify-content: space-between; padding: 0.5rem 0; }
        .file-info-header { font-weight: bold; border-bottom: 1px solid #eee; }
        .file-info-header .file-name, .file-info-row .file-name { flex-basis: 70%; }
        .file-info-header .file-size, .file-info-row .file-size { flex-basis: 30%; }
        #bank_account_file_input { display: none; }

        /* ▼▼▼ ゆうちょ銀行フォーム用の追加スタイル ▼▼▼ */
        .jp-bank-account-number-fields {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .jp-bank-account-number-fields .form-group {
            flex: 1 1 auto;
        }
        .jp-bank-account-number-fields span {
            font-size: 1.5em;
            color: #6c757d;
        }
        #jp_kigo_1 { flex-basis: 150px; }
        #jp_kigo_2 { flex-basis: 80px; }
        #jp_bango { flex-basis: 200px; }
        /* ▲▲▲ 追加スタイルここまで ▲▲▲ */
        /* ▼▼▼ 本人の顔写真と住民票を2カラムにするためのスタイル ▼▼▼ */
        .two-column-uploads {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 1rem;
        }
        /* ▲▲▲ 追加スタイルここまで ▲▲▲ */
        /* ▼▼▼ 契約書テーブル用のスタイル ▼▼▼ */
        .contract-details-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .contract-details-table th,
        .contract-details-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
            vertical-align: top;
        }
        .contract-details-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            width: 30%;
        }
        /* ▲▲▲ 追加スタイルここまで ▲▲▲ */
        /* ▼▼▼ 家族状況セクション用の追加スタイル（レイアウト改善版） ▼▼▼ */
        .dependent-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        .dependent-table th, .dependent-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            vertical-align: middle;
        }
        .dependent-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            width: 25%;
            font-size: 0.9em;
        }
        .dependent-block-header {
            background-color: #e9ecef;
            text-align: left;
            font-weight: bold;
            padding-left: 1rem;
        }
        .add-button, .delete-family-btn {
            display: inline-block;
            padding: 8px 15px;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .add-button {
            background-color: #28a745;
        }
        .delete-family-btn {
            background-color: #dc3545;
        }
        .dependent-table .button-cell {
            text-align: right;
            border: none;
            padding: 10px 0 0 0;
        }
        .button-cell > button {
            margin-left: 8px;
        }
        .dependent-table .radio-group {
            display: flex;
            gap: 1.5rem;
            margin: 0;
        }
        /* ▼▼▼【今回の修正箇所】入力フォームのスタイルを統一 ▼▼▼ */
        .dependent-table input[type="text"],
        .dependent-table input[type="date"],
        .dependent-table select {
            width: 100%; /* 横幅をカラムに合わせる */
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box; /* パディングとボーダーを幅に含める */
            font-size: 14px; /*フォントサイズを他のフォームと合わせる*/
        }

        .dependent-table .radio-group label {
            font-weight: normal;
            display: flex;
            align-items: center;
        }

        .dependent-table .radio-group input[type="radio"] {
            margin-right: 5px;
        }
        /* ▲▲▲ 追加スタイルここまで ▲▲▲ */
        /* ▼▼▼【今回の修正箇所】国籍ラジオボタンの横並び表示 ▼▼▼ */
        .form-group.nationality-options label {
            display: inline-block; /* ラジオボタンのラベルをインラインブロック要素にする */
            margin-right: 20px;   /* 各選択肢の右側に余白を追加 */
        }
/* ▲▲▲ 修正ここまで ▲▲▲ */
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>フロー1：基礎情報</h1>
        <div class="debug-controls">
            <button id="dev_fill_form_btn">テストデータ入力</button>
            <button id="dev_reset_form_btn">フォーム入力リセット</button>
            <button id="dev_clear_storage_btn">LocalStorageクリア</button>
        </div>

        <form action="#" method="post" id="onboardingFormPage1">
            <fieldset class="form-section">
                <legend><h2>モックアップ用設定</h2></legend>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="mock_employment_type">雇用区分</label>
                        <select id="mock_employment_type">
                            <option value="サプラー">サプラー</option>
                            <option value="契約社員">契約社員</option>
                            <option value="契約社員107">契約社員107</option>
                            <option value="地域正社員">地域正社員</option>
                            <option value="正社員">正社員</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="mock_contract_hours">契約時間 (H)</label>
                        <input type="number" id="mock_contract_hours" value="8">
                    </div>
                    <div class="form-group">
                        <label for="mock_contract_days">契約日数 (日)</label>
                        <input type="number" id="mock_contract_days" value="22">
                    </div>
                    <div class="form-group">
                        <label for="mock_salary">給与</label>
                        <input type="number" id="mock_salary" value="1500">
                        <p class="note" id="hourly_wage_note" style="color: red;">※サプラーの場合は時給を入力してください。</p>
                    </div>
                </div>
            </fieldset>
            <fieldset class="form-section">
                <legend><h2>基本情報</h2></legend>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="last_name">姓</label>
                        <input type="text" id="last_name" name="last_name" value="山田">
                    </div>
                    <div class="form-group">
                        <label for="first_name">名</label>
                        <input type="text" id="first_name" name="first_name" value="太郎">
                    </div>
                    <div class="form-group">
                        <label for="last_name_kana">姓（ヨミガナ）</label>
                        <input type="text" id="last_name_kana" name="last_name_kana" value="ヤマダ">
                    </div>
                    <div class="form-group">
                        <label for="first_name_kana">名（ヨミガナ）</label>
                        <input type="text" id="first_name_kana" name="first_name_kana" value="タロウ">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="gender">性別</label>
                        <select id="gender" name="gender">
                            <option value="">選択してください</option>
                            <option value="male" selected>男性</option>
                            <option value="female">女性</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="birth_date">生年月日</label>
                        <input type="date" id="birth_date" name="birth_date" value="1990-01-01">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="department_code">所属事業所コード</label>
                        <input type="text" id="department_code" name="department_code" value="123456" readonly="" class="readonly-field">
                    </div>
                    <div class="form-group">
                        <label for="department">所属事業所名（編集不可）</label>
                        <input type="text" id="department" name="department" value="ONOKICHI事業所" readonly="" class="readonly-field">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="phone_number">電話番号</label>
                        <input type="tel" id="phone_number" name="phone_number" placeholder="例:03-0000-0000" value="03-1234-5678">
                        <p class="description">半角入力 (例)03-0000-0000</p>
                    </div>
                    <div class="form-group">
                        <label for="mobile_phone_number">携帯電話番号</label>
                        <input type="tel" id="mobile_phone_number" name="mobile_phone_number" class="required-field" placeholder="例:080-0000-0000">
                        <p class="description">半角入力 (例)080-0000-0000</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="email">個人メールアドレス</label>
                    <input type="email" id="email" name="email" class="required-field">
                    <p class="description">このメールアドレスはログイン時に必要となります。</p>
                </div>

                <div class="form-group">
                    <div class="two-column-uploads">
                        <div class="document-box" data-doc-id="photo">
                            <input type="file" id="photo_file" name="photo_file" style="display:none;" accept="image/*">
                            <p><strong>本人の顔写真</strong></p>
                            <p class="description">3か月以内の写真</p>
                            
                            <div class="image-preview-box" id="photo_file_preview" style="margin: 0 auto 10px; width:150px;">
                                <span>プレビューなし</span>
                            </div>
                            <label for="photo_file" class="upload-button-placeholder">アップロード</label>
                            <div class="file-upload-status-container">
                                <span class="file-status" id="photo_file_status">選択されていません</span>
                                <button type="button" class="delete-file-btn" data-target-id="photo_file" style="display:none;">削除</button>
                            </div>
                        </div>
                        
                        <div class="document-box" data-doc-id="resident_proof">
                            <input type="file" id="resident_proof_file" name="resident_proof_file" style="display:none;" accept="image/*,.pdf">
                            <p><strong>住民票記載事項証明書もしくは住民票のコピー</strong></p>
                            <p class="description">3か月以内の書類</p>

                            <div class="image-preview-box" id="resident_proof_file_preview" style="margin: 0 auto 10px; width:150px;">
                                <span>プレビューなし</span>
                            </div>
                            <label for="resident_proof_file" class="upload-button-placeholder">画像アップロード</label>
                            <div class="file-upload-status-container">
                                <span class="file-status" id="resident_proof_file_status">選択されていません</span>
                                <button type="button" class="delete-file-btn" data-target-id="resident_proof_file" style="display:none;">削除</button>
                            </div>
                        </div>
                        </div>
                </div>
                <div class="form-group nationality-options">
                    <label>国籍</label>
                    <div class="radio-group">
                        <label><input type="radio" name="nationality" value="japanese" checked> 日本人</label>
                        <label><input type="radio" name="nationality" value="foreign"> 外国籍</label>
                    </div>
                </div>

                <div id="foreign_nationality_details" style="display:none;">
                    <div class="form-group">
                        <label for="country_name">国名</label>
                        <select id="country_name" name="country_name">
                            <option value="">選択してください</option>
                            <option value="vietnam">ベトナム</option>
                            <option value="myanmar">ミャンマー</option>
                            <option value="china">中国</option>
                            <option value="korea">韓国</option>
                            <option value="thailand">タイ</option>
                            <option value="philippines">フィリピン</option>
                            <option value="india">インド</option>
                            <option value="indonesia">インドネシア</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    <div class="form-group" id="country_name_other_group" style="display:none;">
                        <label for="country_name_other">国名（その他）</label>
                        <input type="text" id="country_name_other" name="country_name_other" placeholder="国名を入力してください">
                    </div>
                </div>

                <div class="form-group" id="residence_status_group" style="display:none;"> <label for="residence_status">滞在区分</label>
                    <select id="residence_status" name="residence_status">
                        <option value="">選択してください</option>
                        <option value="student">留学生</option>
                        <option value="family_stay">家族滞在</option>
                        {/* ▼▼▼【今回の修正箇所】▼▼▼ */}
                        <option value="skilled_labor">特定技能</option>
                        {/* ▲▲▲ 修正ここまで ▲▲▲ */}
                        <option value="specified_activities">特定活動</option>
                        <option value="other_permanent_resident">上記以外(外国籍永住者等)</option>
                    </select>
                </div>
            </fieldset>

            <fieldset class="form-section" id="contract_documents_section">
                <legend><h2>契約書類</h2></legend>
                <div class="inline-fields">
                    <div class="document-box clickable-document" data-modal-target="#employmentContractModal" data-contract-id="employmentContract" data-contract-name="雇用契約書 兼 雇入通知書">
                        <span class="document-icon">📄</span>
                        <p>(入社)雇用契約書 兼<br>雇入通知書</p>
                        <p class="contract-status status-pending" id="employmentContractStatus">（未合意）</p>
                        <div class="document-box-post-actions" id="employmentContractPostActions" style="display:none;">
                            <button type="button" class="action-btn-small print-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M16 10c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1zM5 13h4c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1zm12-8H3c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm-1 10H2V7h1V4h14v9zM6 2h8v2H6V2z"/></svg>
                                印刷
                            </button>
                            <button type="button" class="action-btn-small download-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg>
                                ダウンロード
                            </button>
                        </div>
                    </div>
                    <div class="document-box clickable-document" data-modal-target="#guaranteeContractModal" data-contract-id="guaranteeContract" data-contract-name="誓約書">
                        <span class="document-icon">📄</span>
                        <p>誓約書</p>
                         <p class="contract-status status-pending" id="guaranteeContractStatus">（未合意）</p>
                         <div class="document-box-post-actions" id="guaranteeContractPostActions" style="display:none;">
                            <button type="button" class="action-btn-small print-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M16 10c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1zM5 13h4c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1zm12-8H3c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm-1 10H2V7h1V4h14v9zM6 2h8v2H6V2z"/></svg>
                                印刷
                            </button>
                            <button type="button" class="action-btn-small download-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg>
                                ダウンロード
                            </button>
                        </div>
                    </div>
                </div>
                <div id="foreign_documents_container" class="inline-fields" style="display:none; margin-top:15px; gap: 10px; flex-wrap: wrap;">
                    </div>
            </fieldset>

            <fieldset class="form-section">
                <legend><h2>現住所</h2></legend>
                <div class="postal-code-group">
                    <div class="form-group">
                        <label for="postal_code">住所(郵便番号)</label>
                        <input type="text" id="postal_code" name="postal_code" placeholder="例:1000001 または 100-0001" maxlength="8">
                    </div>
                    <button type="button" class="action-button-style" id="search_address_btn">住所検索</button>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="prefecture">住所(都道府県)</label>
                        <input type="text" id="prefecture" name="prefecture" placeholder="例:東京都">
                    </div>
                     <div class="form-group">
                        <label for="city">住所(市区町村)</label>
                        <input type="text" id="city" name="city" placeholder="例:千代田区">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="address_line1">住所(町名・番地)</label>
                        <input type="text" id="address_line1" name="address_line1" placeholder="例:千代田 1-1">
                    </div>
                    <div class="form-group">
                        <label for="address_line2">住所(建物名・部屋番号)</label>
                        <input type="text" id="address_line2" name="address_line2" placeholder="例:〇〇ビル101号室">
                    </div>
                </div>
                 <div class="form-group">
                    <label for="address_kana">住所(ヨミガナ)</label>
                    <input type="text" id="address_kana" name="address_kana" placeholder="例:トウキョウトチヨダクチヨダ">
                </div>
            </fieldset>

            <fieldset class="form-section">
                <legend><h2>緊急連絡先</h2></legend>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="emergency_last_name">(姓)</label>
                        <input type="text" id="emergency_last_name" name="emergency_last_name" placeholder="例: 鈴木">
                    </div>
                    <div class="form-group">
                        <label for="emergency_first_name">(名)</label>
                        <input type="text" id="emergency_first_name" name="emergency_first_name" placeholder="例: 花子">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="emergency_last_name_kana">(姓:ヨミガナ)</label>
                        <input type="text" id="emergency_last_name_kana" name="emergency_last_name_kana" placeholder="例: スズキ">
                    </div>
                    <div class="form-group">
                        <label for="emergency_first_name_kana">(名:ヨミガナ)</label>
                        <input type="text" id="emergency_first_name_kana" name="emergency_first_name_kana" placeholder="例: ハナコ">
                    </div>
                </div>
                <div class="postal-code-group">
                    <div class="form-group">
                        <label for="emergency_postal_code">住所(郵便番号)</label>
                        <input type="text" id="emergency_postal_code" name="emergency_postal_code" placeholder="例: 1000002 または 100-0002" maxlength="8">
                    </div>
                    <button type="button" class="action-button-style" id="search_emergency_address_btn">住所検索</button>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="emergency_prefecture">住所(都道府県)</label>
                        <input type="text" id="emergency_prefecture" name="emergency_prefecture" placeholder="例: 東京都">
                    </div>
                     <div class="form-group">
                        <label for="emergency_city">住所(市区町村)</label>
                        <input type="text" id="emergency_city" name="emergency_city" placeholder="例: 千代田区">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="emergency_address_line1">住所(町名・番地)</label>
                        <input type="text" id="emergency_address_line1" name="emergency_address_line1" placeholder="例:皇居外苑 1-2">
                    </div>
                    <div class="form-group">
                        <label for="emergency_address_line2">住所(建物名・部屋番号)</label>
                        <input type="text" id="emergency_address_line2" name="emergency_address_line2" placeholder="例: パレスビル202号室">
                    </div>
                </div>
                <div class="inline-fields">
                    <div class="form-group">
                        <label for="emergency_phone">(電話番号)</label>
                        <input type="tel" id="emergency_phone" name="emergency_phone" placeholder="例: 090-1111-2222">
                        <p class="description">半角入力 (例)090-1111-2222</p>
                    </div>
                    <div class="form-group">
                        <label for="emergency_relationship">(続柄)</label>
                        <select id="emergency_relationship" name="emergency_relationship">
                            <option value="">選択してください</option>
                            <option value="parent">親</option>
                            <option value="spouse">配偶者</option>
                            <option value="child">子</option>
                            <option value="sibling">兄弟姉妹</option>
                            <option value="other_relative">その他親族</option>
                            <option value="friend">友人</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                </div>
            </fieldset>

            <fieldset class="form-section">
                <legend><h2>家族状況</h2></legend>
                <div id="family_entries_container">
                    </div>
            </fieldset>

            <fieldset class="form-section">
                <legend><h2>給与支払口座</h2></legend>
                <p class="description">本人名義のもの。口座番号等情報と氏名が表裏で表記のある場合は、両面アップロードをお願いいたします。</p>

                <div class="form-group">
                    <div class="two-column-uploads">

                        <div class="document-box" data-doc-id="bank_account_front">
                            <input type="file" id="bank_account_front_file" name="bank_account_front_file" style="display:none;" accept="image/*,.pdf">
                            <p><strong>通帳・カード（表面）</strong></p>
                            <p class="description">口座番号・名義がわかる面</p>
                            <div class="image-preview-box" id="bank_account_front_file_preview" style="margin: 0 auto 10px; width:150px; height:100px;">
                                <span>プレビューなし</span>
                            </div>
                            <label for="bank_account_front_file" class="upload-button-placeholder">アップロード</label>
                            <div class="file-upload-status-container">
                                <span class="file-status" id="bank_account_front_file_status">選択されていません</span>
                                <button type="button" class="delete-file-btn" data-target-id="bank_account_front_file" style="display:none;">削除</button>
                            </div>
                        </div>

                        <div class="document-box" data-doc-id="bank_account_back">
                            <input type="file" id="bank_account_back_file" name="bank_account_back_file" style="display:none;" accept="image/*,.pdf">
                            <p><strong>通帳・カード（裏面）</strong></p>
                            <p class="description">必要に応じてアップロード</p>
                             <div class="image-preview-box" id="bank_account_back_file_preview" style="margin: 0 auto 10px; width:150px; height:100px;">
                                <span>プレビューなし</span>
                            </div>
                            <label for="bank_account_back_file" class="upload-button-placeholder">アップロード</label>
                            <div class="file-upload-status-container">
                                <span class="file-status" id="bank_account_back_file_status">選択されていません</span>
                                <button type="button" class="delete-file-btn" data-target-id="bank_account_back_file" style="display:none;">削除</button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="form-group">
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="bank_type" value="general" checked onchange="toggleBankAccountForm()">
                            銀行
                        </label>
                        <label>
                            <input type="radio" name="bank_type" value="jp" onchange="toggleBankAccountForm()">
                            ゆうちょ銀行
                        </label>
                    </div>
                </div>

                <div id="general-bank-form">
                    <div class="inline-fields">
                        <div class="form-group" style="flex: 2 1 0%;">
                            <label for="general_bank_name">銀行名</label>
                            <input type="text" id="general_bank_name" name="general_bank_name" autocomplete="off" placeholder="例: 三菱UFJ銀行">
                            <div class="suggestion-box" id="bank_name_suggestions"></div>
                        </div>
                        <div class="form-group" style="flex: 1 1 0%;">
                            <label for="general_bank_code">金融機関コード</label>
                            <input type="text" id="general_bank_code" name="general_bank_code" placeholder="自動入力" readonly class="readonly-field">
                        </div>
                    </div>
                    <div class="inline-fields">
                        <div class="form-group" style="flex: 2 1 0%;">
                            <label for="general_branch_name">支店名</label>
                            <input type="text" id="general_branch_name" name="general_branch_name" autocomplete="off" placeholder="例: 渋谷支店">
                            <div class="suggestion-box" id="branch_name_suggestions"></div>
                        </div>
                         <div class="form-group" style="flex: 1 1 0%;">
                            <label for="general_branch_code">支店コード</label>
                            <input type="text" id="general_branch_code" name="general_branch_code" placeholder="自動入力" readonly class="readonly-field">
                        </div>
                    </div>
                    <div class="inline-fields">
                         <div class="form-group">
                            <label for="general_account_type">預金種別</label>
                            <input type="text" id="general_account_type" name="general_account_type" value="普通" readonly class="readonly-field">
                        </div>
                        <div class="form-group">
                            <label for="general_account_number">口座番号</label>
                            <input type="text" id="general_account_number" name="general_account_number" placeholder="例: 1234567" maxlength="7">
                        </div>
                        <div class="form-group">
                            <label for="general_account_holder_name">名義(カタカナ)</label>
                            <input type="text" id="general_account_holder_name" name="general_account_holder_name" placeholder="例: ヤマダ タロウ">
                        </div>
                    </div>
                </div>

                <div id="jp-bank-form" style="display: none;">
                    <div class="form-group">
                        <label for="jp_bank_name">銀行名</label>
                        <input type="text" id="jp_bank_name" name="jp_bank_name" value="ゆうちょ銀行" readonly class="readonly-field">
                    </div>
                    
                    <div class="form-group">
                        <label>口座の記号・番号を入力</label>
                        <div class="jp-bank-account-number-fields">
                            <div class="form-group">
                                <label for="jp_kigo_1" style="font-weight:normal;">記号 (半角)</label>
                                <input type="tel" id="jp_kigo_1" name="jp_kigo_1" maxlength="5" placeholder="例: 12345">
                            </div>
                            <span>-</span>
                            <div class="form-group">
                                <label for="jp_kigo_2" style="font-weight:normal;">&nbsp;</label>
                                <input type="tel" id="jp_kigo_2" name="jp_kigo_2" maxlength="1" placeholder="例: 1">
                            </div>
                            <span>-</span>
                            <div class="form-group">
                                <label for="jp_bango" style="font-weight:normal;">番号 (半角)</label>
                                <input type="tel" id="jp_bango" name="jp_bango" maxlength="8" placeholder="例: 12345678">
                            </div>
                        </div>
                         <p class="description">※記号と番号の間に1桁の数字がない場合は、真ん中の入力欄は空欄にしてください。</p>
                    </div>

                     <div class="inline-fields">
                        <div class="form-group">
                            <label for="jp_account_type">預金種別</label>
                            <input type="text" id="general_account_type" name="general_account_type" value="普通" readonly class="readonly-field">
                        </div>
                         <div class="form-group">
                            <label for="jp_account_holder_name">名義(カタカナ)</label>
                            <input type="text" id="jp_account_holder_name" name="jp_account_holder_name" placeholder="例：ヤマダ タロウ">
                        </div>
                    </div>

                    </div>
            </fieldset>
            <div class="navigation-buttons">
                <span></span> <a href="フロー2_社保加入申請.html" class="action-button-style next-btn" id="saveAndNext">次へ（フロー2_社保加入申請）</a>
            </div>
        </form>
    </div>

    <div id="employmentContractModal" class="modal contract-agreement-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employmentContractModalTitle">労働条件通知書 兼 雇用契約書</h3>
                <span class="close-button" data-modal-id="employmentContractModal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="contract-viewer">
                    <h3 style="text-align: center; font-size: 1.4em; margin-bottom: 1em;">労働条件通知書 兼 雇用契約書</h3>
                    <table class="contract-details-table">
                        <tbody>
                            <tr><th>被用者名</th><td>岡本太郎</td></tr>
                            <tr><th>社員番号</th><td>999999</td></tr>
                            <tr><th>雇用区分</th><td>サプラー《サプラー》</td></tr>
                            <tr><th>入社日</th><td>2025年 4月 25日</td></tr>
                            <tr><th>契約終了日</th><td>2025年 9月 30日</td></tr>
                            <tr><th>事業所名</th><td>みぎわーむ</td></tr>
                            <tr><th>事業所 CD</th><td>201712</td></tr>
                            <tr><th>業務内容</th><td>調理および付随業務全般</td></tr>
                            <tr><th>契約時間</th><td>8 時間</td></tr>
                            <tr><th>契約日数</th><td>22 日</td></tr>
                            <tr><th>基本的な勤務パターン1</th><td>5時30分～14時30分（内休憩60分）</td></tr>
                            <tr><th>基本的な勤務パターン2</th><td>10時30分～19時30分（内休憩60分）</td></tr>
                            <tr><th>給与(時間給)</th><td>1,500 円</td></tr>
                            <tr><th>第2加算時給</th><td></td></tr>
                            <tr><th>第3加算時給</th><td></td></tr>
                            <tr><th>第4加算時給</th><td></td></tr>
                            <tr><th>{手当名}手当1</th><td></td></tr>
                            <tr><th>{手当名}手当2</th><td></td></tr>
                            <tr><th>{手当名}手当3</th><td></td></tr>
                            <tr><th>賞与</th><td>なし</td></tr>
                            <tr><th>社会保険</th><td>契約条件が法定の要件を満たした場合に、健康保険・厚生年金・雇用保険に加入いただきます。</td></tr>
                            <tr><th>休日</th><td>契約日数に基づき、月次シフト表により指示します。</td></tr>
                            <tr><th>有給休暇</th><td>入社から6か月間、契約日数の8割以上勤務した場合に初回付与します。付与日数は契約日数によって異なります。2回目以降は入社より1年6ヶ月後、以降毎年4月1日に就業規則に定める基準を満たした場合に付与します。</td></tr>
                            <tr><th>契約更新</th><td>契約社員は毎年7月1日、サプラーは毎年10月1日に更新します。更新の有無は契約期間満了時の業務量、勤務成績、態度、能力、経営状況等により判断します。</td></tr>
                            <tr><th>給与改定</th><td>契約社員・サプラー：次回契約更新時に個人の評価、会社業績等により見直しを行う場合があります。初回契約期間中に給与を改定する場合は、別途変更雇用契約書を作成することとします。（試用期間給から本給への変更も含む）</td></tr>
                            <tr><th>退職金</th><td>正社員・地域正社員：10年以上勤続した場合に、規程に基づき支給します。<br>契約社員・サプラー：ありません。</td></tr>
                            <tr><th>定年</th><td>正社員・地域正社員・契約社員：満70歳</td></tr>
                            <tr><th>その他</th><td>
                                <li>月度における勤務日数、時間については業務の状況により変動することがあります。</li>
                                <li>業務上の必要に応じて勤務地を変更することがあります。</li>
                                <li>所定外労働・休日労働をさせることがあります。</li>
                                <li>マネージャー(MGR)職以上については、その役職手当をみなし時間外勤務手当とします。申請した時間外勤務手当が、それぞれの月間固定時間外勤務手当を超えた場合に、超過額を別途支給します。</li>
                                <li>正社員・地域正社員・契約社員が契約期間中に満 65 歳の誕生日を迎えた場合、原則として誕生月の翌月より基本給を引き下げます。引き下げは基本給のみが対象となり、役職に応じた役職手当については変更ありません。</li>
                                <li>賃金は毎月末日締めとし、翌月 20 日に被用者本人の指定口座に振り込みます。</li>
                                <li>退職及び解雇の基準は就業規則に準じます。</li>
                                <li>上記に記載されていないほかの就労条件等は、就業規則に準じます。</li>
                            </td></tr>
                            <tr><th>使用者 会社名</th><td>株式会社 LEOC</td></tr>
                            <tr><th>使用者 代表取締役</th><td>田島 利行</td></tr>
                        </tbody>
                    </table>
                    
                    <div class="agreement-details" id="employmentContract_agreement_details" style="text-align: right; margin-top: 25px; font-size: 16px; line-height: 1.5;"></div>
    
                    <div class="additional-contract-info" style="text-align: left; font-size: 14px; line-height: 1.6; margin-top: 2em;">
                        <h1 style="font-size: 1.3em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 1.5em;">雇用契約締結時における注意事項等</h1>
    
                        <h2 style="font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 1.5em;">■ 時間外勤務手当について</h2>
                        <p>
                        部長職以下で、所定した所定労働時間を超える勤務を行った場合はその時間分の手当を支給します。<br>
                        また、下記条件に該当する時間外勤務については割増賃金を支給します。
                        </p>
                        <ol style="padding-left: 20px;">
                            <li>一日の実労働時間が8時間を超えた場合、または平均した実労働時間が一日あたり8時間を超えた場合の超過分。</li>
                            <li>一ヶ月の労働時間が下記月間法定労働時間を超えた場合の超過分。</li>
                        </ol>
    
                        <table class="contract-details-table" style="margin-top: 15px; font-size: 13px; table-layout: fixed; width: 100%;">
                            <thead>
                                <tr>
                                    <th style="text-align: center; width: 30%;">暦日</th>
                                    <th style="text-align: center; width: 17.5%;">暦日 31 日の月</th>
                                    <th style="text-align: center; width: 17.5%;">暦日 30 日の月</th>
                                    <th style="text-align: center; width: 17.5%;">暦日 29 日の月</th>
                                    <th style="text-align: center; width: 17.5%;">暦日 28 日の月</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="text-align: center; background-color: #f8f9fa; font-weight: bold;">月間法定労働時間</td>
                                    <td style="text-align: center;">177 時間</td>
                                    <td style="text-align: center;">171 時間</td>
                                    <td style="text-align: center;">165 時間</td>
                                    <td style="text-align: center;">160 時間</td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="font-size: 0.9em; color: #555; margin-top: 5px;">
                        ※マネージャー(MGR)職以上については、その役職手当をみなし時間外勤務手当とします。<br>申請した時間外勤務手当が、それぞれの役職の時間外勤務手当を超えた場合に、超過額を別途支給します。
                        </p>
    
                        <h2 style="font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 1.5em;">■ 休日勤務手当について</h2>
                        <p>
                        月間を通して、月の公休を取得しきれない勤務を行った場合は、別途休日勤務手当を支給します。
                        </p>
                        <ul style="padding-left: 20px;">
                            <li>正社員・地域正社員・契約社員の公休は年間 121 日、契約社員 107 の公休は年間 107 日となります。<br>各月ごとの公休はシフト表などで通知します。</li>
                            <li>サプラーの公休は月間5日 (2月のみ4日)となります。</li>
                        </ul>
    
                        <h2 style="font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 1.5em;">■ 有給休暇について</h2>
                        <p>
                        所定労働日数の8割以上出勤した場合、入社日の6か月後より下表の通り付与されます。
                        </p>
                        <table class="contract-details-table" style="margin-top: 15px; font-size: 12px; text-align: center; table-layout: fixed; width: 100%;">
                            <thead>
                                <tr>
                                    <th colspan="2" style="text-align: center; width: 28%;"></th>
                                    <th colspan="7" style="text-align: center; width: 72%;">付与回数</th>
                                </tr>
                                <tr>
                                    <th colspan="2" style="text-align: center;"></th>
                                    <th style="text-align: center;">1回目</th>
                                    <th style="text-align: center;">2回目</th>
                                    <th style="text-align: center;">3回目</th>
                                    <th style="text-align: center;">4回目</th>
                                    <th style="text-align: center;">5回目</th>
                                    <th style="text-align: center;">6回目</th>
                                    <th style="text-align: center;">7回目以降~</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="2" style="text-align: center; background-color: #f8f9fa; font-weight: bold;">付与基準日</td>
                                    <td style="text-align: center;">入社<br>6ヶ月</td>
                                    <td style="text-align: center;">入社<br>1年6ヶ月</td>
                                    <td style="text-align: center;">次の年度<br>4月</td>
                                    <td style="text-align: center;">4月</td>
                                    <td style="text-align: center;">4月</td>
                                    <td style="text-align: center;">4月</td>
                                    <td style="text-align: center;">4月</td>
                                </tr>
                                <tr>
                                    <td colspan="2" style="text-align: center; background-color: #f8f9fa; font-weight: bold;">社員・契約社員</td>
                                    <td style="text-align: center;">10日</td>
                                    <td style="text-align: center;">11日</td>
                                    <td style="text-align: center;">12日</td>
                                    <td style="text-align: center;">14日</td>
                                    <td style="text-align: center;">16日</td>
                                    <td style="text-align: center;">18日</td>
                                    <td style="text-align: center;">20日</td>
                                </tr>
                                <tr>
                                    <td rowspan="5" style="text-align: center; vertical-align: middle; background-color: #f8f9fa; font-weight: bold;">サプラー<br>・<br>月の契約日数</td>
                                    <td style="text-align: center;">19日以上</td>
                                    <td style="text-align: center;">10日</td>
                                    <td style="text-align: center;">11日</td>
                                    <td style="text-align: center;">12日</td>
                                    <td style="text-align: center;">14日</td>
                                    <td style="text-align: center;">16日</td>
                                    <td style="text-align: center;">18日</td>
                                    <td style="text-align: center;">20日</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">15日以上</td>
                                    <td style="text-align: center;">7日</td>
                                    <td style="text-align: center;">8日</td>
                                    <td style="text-align: center;">9日</td>
                                    <td style="text-align: center;">10日</td>
                                    <td style="text-align: center;">12日</td>
                                    <td style="text-align: center;">13日</td>
                                    <td style="text-align: center;">15日</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">11日以上</td>
                                    <td style="text-align: center;">5日</td>
                                    <td style="text-align: center;">6日</td>
                                    <td style="text-align: center;">6日</td>
                                    <td style="text-align: center;">8日</td>
                                    <td style="text-align: center;">9日</td>
                                    <td style="text-align: center;">10日</td>
                                    <td style="text-align: center;">11日</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">7日以上</td>
                                    <td style="text-align: center;">3日</td>
                                    <td style="text-align: center;">4日</td>
                                    <td style="text-align: center;">4日</td>
                                    <td style="text-align: center;">5日</td>
                                    <td style="text-align: center;">6日</td>
                                    <td style="text-align: center;">6日</td>
                                    <td style="text-align: center;">7日</td>
                                </tr>
                                <tr>
                                    <td style="text-align: center;">4日以上</td>
                                    <td style="text-align: center;">1日</td>
                                    <td style="text-align: center;">2日</td>
                                    <td style="text-align: center;">2日</td>
                                    <td style="text-align: center;">2日</td>
                                    <td style="text-align: center;">3日</td>
                                    <td style="text-align: center;">3日</td>
                                    <td style="text-align: center;">3日</td>
                                </tr>
                            </tbody>
                        </table>
                        <p style="font-size: 0.9em; color: #555; margin-top: 5px;">
                        ※3回目以降の付与では、その2回前に付与された有休の残数は消滅し、積立傷病休暇に加算されます（最大60日）
                        </p>
    
                        <h2 style="font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 1.5em;">■ 期間中の雇用契約解除について</h2>
                        <p>
                        下記事由に該当する場合は、雇用契約期間中であっても契約を終了する場合があります。
                        </p>
                        <ol style="padding-left: 20px;">
                            <li>精神または身体の疾患および疾病により、職務に堪えないとき</li>
                            <li>作業能率または勤務成績が不良で、職務に適さないとき</li>
                            <li>出勤常ならず、職務を果たさないとき</li>
                            <li>事業所廃止または縮小、その他事業運営上やむを得ない事情により従業員の削減が必要になったとき</li>
                            <li>会社の規律・秩序を乱し、復旧しがたくて企業を受けても改善されないとき</li>
                            <li>会社の定める就業規則、懲戒事由のいずれか、就業に適さないとき</li>
                            <li>客商売中に該当すると認められたとき</li>
                            <li>会社の行動規範に違反したとき</li>
                            <li>その他やむを得ない事由のあるとき</li>
                        </ol>
                    </div>
                </div>
                
                <div id="employmentContract_pre_agreement_content">
                    <p class="action-prompt">書類を確認のうえ、「合意に進む」を押してください。</p>
                    <div id="insurance_confirmation_section" style="display:none; border: 1px solid #e0e0e0; padding: 15px; margin: 10px 20px; border-radius: 5px; background-color: #f9f9f9;">
                        <h4 style="margin-top:0; margin-bottom:10px; font-size: 1.1em; color: #333; border:none;">加入保険の確認</h4>
                        <div id="employment_insurance_check_div" class="checkbox-group" style="display:none; margin-bottom: 5px;">
                            <label style="font-weight: normal; display: flex; align-items: center; margin-bottom: 0;">
                                <input type="checkbox" id="confirm_employment_insurance" name="confirm_insurance" value="employment"> 雇用保険加入することを確認
                            </label>
                        </div>
                        <div id="social_insurance_check_div" class="checkbox-group" style="display:none; margin-bottom: 5px;">
                            <label style="font-weight: normal; display: flex; align-items: center; margin-bottom: 0;">
                                <input type="checkbox" id="confirm_social_insurance" name="confirm_insurance" value="social"> 社会保険加入することを確認
                            </label>
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="action-btn reject-btn" data-contract-id="employmentContract">差し戻す</button>
                        <button type="button" class="action-btn agree-btn" data-contract-id="employmentContract">合意に進む</button>
                    </div>
                    <form id="employmentContract_agree_form" style="display:none;">
                         <div class="form-group">
                            <label for="employmentContract_signer_name">署名<span class="required-label">必須</span></label>
                            <input type="text" id="employmentContract_signer_name" name="signer_name" placeholder="例: 鈴木 一郎">
                            <span class="error-message" id="employmentContract_signer_name_error"></span>
                        </div>
                        <div class="form-group">
                            <label>書類の受け取り方法<span class="required-label">必須</span></label>
                            <div class="checkbox-group agree-modal-body"> 
                                <input type="checkbox" id="employmentContract_agree_electronic_delivery" name="agree_electronic_delivery" checked>
                                <label for="employmentContract_agree_electronic_delivery">電子通知で受け取ることに同意する</label>
                            </div>
                            <span class="error-message" id="employmentContract_agree_delivery_error"></span>
                        </div>
                    </form>
                     <form id="employmentContract_reject_form" style="display:none;">
                        <div class="form-group">
                            <label for="employmentContract_reject_reason">差し戻し理由<span class="required-label">必須</span></label>
                            <textarea id="employmentContract_reject_reason" name="reject_reason" placeholder="差し戻しの理由を入力します"></textarea>
                            <span class="error-message" id="employmentContract_reject_reason_error"></span>
                        </div>
                    </form>
                </div>
    
                <div class="post-agreement-actions-modal" id="employmentContract_post_agreement_content">
                    <p class="action-prompt" style="color:green; font-weight:bold;">この書類は合意済みです。</p>
                    <div class="action-buttons-row-inner">
                        <button type="button" class="action-btn-small print-contract-btn">
                            <svg viewBox="0 0 20 20"><path d="M16 10c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1zM5 13h4c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1zm12-8H3c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm-1 10H2V7h1V4h14v9zM6 2h8v2H6V2z"/></svg>
                            印刷
                        </button>
                        <button type="button" class="action-btn-small download-contract-btn">
                            <svg viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg>
                            ダウンロード
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer" id="employmentContract_modal_footer">
                </div>
        </div>
    </div>
    
        <div id="guaranteeContractModal" class="modal contract-agreement-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="guaranteeContractModalTitle">誓約書</h3>
                    <span class="close-button" data-modal-id="guaranteeContractModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="contract-viewer">
                        <div class="contract-text-content" style="text-align: left; font-size: 16px; line-height: 1.6;">
                            <h3 style="text-align: center; font-size: 1.4em; margin-bottom: 1em;">誓約書</h3>
                            <p>私は、今般貴社に入社するにあたり、本紙裏面に記載の誓約事項および貴社の就業規則、その他の諸規定を遵守し、誠実に職務に精励することを誓約いたします。</p>
                            <h4 style="margin-top: 1.5em; font-size: 1.2em; border-bottom: 1px solid #ccc; padding-bottom: 0.2em;">誓約事項</h4>
                            
                            <h4 style="margin-top: 1em; font-weight: bold;">【遵守事項】</h4>
                            <ol style="padding-left: 20px; margin-top: 0.5em;">
                                <li>貴社（貴社のグループ会社を含みます。以下同じ。）の就業規則、諸規程及びその他の諸規則により定められた内容を十分に理解し、これを遵守します。</li>
                                <li>貴社の経営方針、行動基準、所属長・上司の指揮命令に従い誠実に勤務します。また、貴社の業務にかかわるすべての関係者に対し、相手を尊重して明朗快活に接し、良好な人間関係を築きます。</li>
                                <li>貴社の業務に専念し、貴社の事業目標の達成に貢献するよう勤務します。また、貴社の利益に相反する不当な活動及び競業的行為を一切行いません。</li>
                                <li>社内外を問わず貴社の名誉、信用その他の社会的評価を害し、企業秩序を乱すことのないように行動します。また、演説、出版、放送、取材、インターネット、SNS等により貴社の不利益になる情報を流布することをしません。</li>
                                <li>貴社の業務を遂行する上で必要な情報はすべて正確に社内関係者と共有し、また、上司からの求めに応じて正確に報告します。</li>
                                <li>貴社に提出した履歴書、その他入社手続関係書類の記載事項、及び採用選考時等に口述した内容は事実であることを保証します。</li>
                                <li>貴社の業務の必要に応じて、担当職務、勤務形態の変更、転勤、及び出向等を命ぜられた場合はこれに従います。</li>
                                <li>貴社の業務推進に十分な力を発揮するために、自らの精神的及び身体的な健康を維持するよう、私生活においても十分に留意します。</li>
                                <li>貴社が必要に応じて行う所持品検査、及び情報端末の使用履歴並びに保存情報の調査を行う場合は、これに進んで協力します。</li>
                                <li>自らが暴力団員、暴力団関係者及びその他の反社会的勢力ではなく、現在から将来にわたってこれらとの関係を持つことはありません。</li>
                                <li>貴社の業務にかかわる関係者が、法令違反その他の反社会的行為を行っている事実を知り得たときは、可能な限り損害を防止する措置を講じたうえで、直ちに貴社の上司に報告します。</li>
                                <li>故意又は重大な過失により貴社に損害を与えたときはその責任を負い、貴社が被った損害を賠償します。</li>
                                <li>就業規則の規定に基づきハラスメント行為をしない事を誓います。本制約を破った場合には、会社からの相応の処分を受け入れます。</li>
                                <li>以上各項の他、社業の発展に進んで協力し、それを妨げる言動は行いません。</li>
                            </ol>
    
                            <h4 style="margin-top: 1.5em; font-weight: bold;">【体調管理に関する事項】</h4>
                            <ol style="padding-left: 20px; margin-top: 0.5em;">
                                <li>別紙『体調不良に関する従業員の皆様へのお願い』を確認し、体調不良時の対応を厳守遵守することを誓います。</li>
                                <li>定期健康診断、その後の二次診断、及び貴社が随時指定する医師の診断について貴社の指示に従って受診し、その結果をすべて遅滞なく報告します。また、貴社の健康管理上の指示についても従います。</li>
                            </ol>
    
                            <h4 style="margin-top: 1.5em; font-weight: bold;">【貴社機密情報及び個人情報等の守秘に関する事項】</h4>
                            <ol style="padding-left: 20px; margin-top: 0.5em;">
                                <li>業務を遂行する過程で知り得る一切の機密情報を、貴社、貴社社員、および貴社顧客の機密情報と認識し、私に対する指揮命令者を除く貴社役員、社員などの従事者およびその他の第三者に漏洩若しくは開示をせず、不正な使用、複製、複写を致しません。また、自己の利益のための者若しくは貴社と競合する他の事業者その他の第三者にも機密情報を漏洩または開示をしません。</li>
                                <li>機密情報とは、以下の情報等であることを確認します。
                                    <ol type="i" style="padding-left: 20px; margin-top: 0.5em;">
                                        <li>貴社の顧客及び提携企業等に係る取引内容、売上高、請求金額、月次収支等全ての情報</li>
                                        <li>貴社の役員、従業員等（正社員のみならず、パート・アルバイト、契約社員及び派遣社員を含む。）、採用応募者等及び退職者に係る住所等の全ての個人情報、給与等の全ての雇用情報</li>
                                        <li>外食店舗利用者の全ての個人情報、企業情報</li>
                                        <li>施設入居者、食堂利用者等に係る全ての個人情報</li>
                                        <li>技術上の情報、知的財産権に関する情報</li>
                                        <li>貴社の財務内容等に関する情報</li>
                                        <li>上司又は営業秘密等管理責任者により秘密情報として指定された情報</li>
                                        <li>前各号のほか、貴社が特に秘密保持対象として指定した情報</li>
                                    </ol>
                                </li>
                                <li>施設、機器並びにネットワーク環境等を利用するにあたり、機密および個人情報の秘密を守るために、次のことを実行します。
                                    <ol type="i" style="padding-left: 20px; margin-top: 0.5em;">
                                        <li>施設、設備、機器、ネットワーク環境並びにその他備品等を、業務を遂行する目的以外に使用しないこと又は許可なく事業所外に持ち出さないこと。</li>
                                        <li>職務権限者の許可なく機密又は個人情報を紙、FD、CD などの記録媒体に記録し、又は電子媒体等を用いて外部へ持ち出さないこと。</li>
                                        <li>職務権限者の指定もしくは許可していないソフトを作動又はインストールしないこと。</li>
                                    </ol>
                                </li>
                                <li>上記事項のいずれかに反したことにより、正当な手続きを経た上で就業規則に基づいての懲戒処分を受けたとしても、私は一切異議を申し立てず貴社の処分に従います。</li>
                                <li>万一、上記事項のいずれかに反したことにより、貴社に損害を与えた場合には、その責めに応じかつ賠償を請求されたとしても異議の申立をせず、その請求に応じます。</li>
                                <li>本誓約は貴社退職後も有効であることを確認いたします。</li>
                            </ol>
                        </div>
                        <div class="agreement-details" id="guaranteeContract_agreement_details" style="text-align: right; margin-top: 20px; font-size: 16px; line-height: 1.5;"></div>
                    </div>
    
                    <div id="guaranteeContract_pre_agreement_content">
                        <p class="action-prompt">書類を確認のうえ、「合意に進む」を押してください。</p>
                        <div class="button-group">
                            <button type="button" class="action-btn reject-btn" data-contract-id="guaranteeContract">差し戻す</button>
                            <button type="button" class="action-btn agree-btn" data-contract-id="guaranteeContract">合意に進む</button>
                        </div>
                         <form id="guaranteeContract_agree_form" style="display:none;">
                             <div class="form-group">
                                <label for="guaranteeContract_signer_name">署名<span class="required-label">必須</span></label>
                                <input type="text" id="guaranteeContract_signer_name" name="signer_name" placeholder="例: 佐藤 花子">
                                <span class="error-message" id="guaranteeContract_signer_name_error"></span>
                            </div>
                            <div class="form-group">
                                <label>書類の受け取り方法<span class="required-label">必須</span></label>
                                <div class="checkbox-group agree-modal-body">
                                    <input type="checkbox" id="guaranteeContract_agree_electronic_delivery" name="agree_electronic_delivery" checked>
                                    <label for="guaranteeContract_agree_electronic_delivery">電子通知で受け取ることに同意する</label>
                                </div>
                                 <span class="error-message" id="guaranteeContract_agree_delivery_error"></span>
                            </div>
                        </form>
                        <form id="guaranteeContract_reject_form" style="display:none;">
                            <div class="form-group">
                                <label for="guaranteeContract_reject_reason">差し戻し理由<span class="required-label">必須</span></label>
                                <textarea id="guaranteeContract_reject_reason" name="reject_reason" placeholder="差し戻しの理由を入力します"></textarea>
                                <span class="error-message" id="guaranteeContract_reject_reason_error"></span>
                            </div>
                        </form>
                    </div>
                    <div class="post-agreement-actions-modal" id="guaranteeContract_post_agreement_content">
                         <p class="action-prompt" style="color:green; font-weight:bold;">この書類は合意済みです。</p>
                        <div class="action-buttons-row-inner">
                            <button type="button" class="action-btn-small print-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M16 10c0 .55-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1h10c.55 0 1 .45 1 1zM5 13h4c.55 0 1 .45 1 1s-.45 1-1 1H5c-.55 0-1-.45-1-1s.45-1 1-1zm12-8H3c-.55 0-1 .45-1 1v2H1c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1h18c.55 0 1-.45 1-1V6c0-.55-.45-1-1-1zm-1 10H2V7h1V4h14v9zM6 2h8v2H6V2z"/></svg>
                                印刷
                            </button>
                            <button type="button" class="action-btn-small download-contract-btn">
                                <svg viewBox="0 0 20 20"><path d="M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"/></svg>
                                ダウンロード
                            </button>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" id="guaranteeContract_modal_footer">
                    </div>
            </div>
        </div>
    
        <script>
            // --- START: 給与支払口座フォーム切り替え機能 ---
            function toggleBankAccountForm() {
                const isJpBank = document.querySelector('input[name="bank_type"][value="jp"]').checked;
                const generalForm = document.getElementById('general-bank-form');
                const jpBankForm = document.getElementById('jp-bank-form');
                
                const generalInputs = generalForm.querySelectorAll('input, select');
                const jpInputs = jpBankForm.querySelectorAll('input, select');
    
                if (isJpBank) {
                    jpBankForm.style.display = 'block';
                    generalForm.style.display = 'none';
                    jpInputs.forEach(input => input.disabled = false);
                    generalInputs.forEach(input => input.disabled = true);
                } else {
                    generalForm.style.display = 'block';
                    jpBankForm.style.display = 'none';
                    generalInputs.forEach(input => input.disabled = false);
                    jpInputs.forEach(input => input.disabled = true);
                }
            }
            // --- END: 給与支払口座フォーム切り替え機能 ---
    
            document.addEventListener('DOMContentLoaded', function () {
                // --- START: File Upload Logic ---
                function setupFileUpload(parentElement) {
                    const targetSelector = parentElement ? parentElement.querySelectorAll('.document-box, .file-upload-wrapper') : document.querySelectorAll('.document-box');
    
                    targetSelector.forEach(docBox => {
                        const fileInput = docBox.querySelector('input[type="file"]');
                        const statusSpan = docBox.querySelector('.file-status');
                        const deleteBtn = docBox.querySelector('.delete-file-btn');
                        const uploadLabel = docBox.querySelector('.upload-button-placeholder');
    
                        if (!fileInput || !statusSpan || !uploadLabel) return;
                        
                        statusSpan.dataset.initialText = statusSpan.textContent; 
                        uploadLabel.dataset.initialLabel = uploadLabel.textContent;
                        
                        const storedFilename = localStorage.getItem(fileInput.id + '_filename');
                        if (storedFilename) {
                            statusSpan.textContent = storedFilename;
                            if(deleteBtn) deleteBtn.style.display = 'inline-block';
                            uploadLabel.textContent = '変更';
                            // NOTE: ページ読み込み時のサムネイル復元は複雑化するため、今回は実装から除外
                        }
    
                        fileInput.addEventListener('change', function() {
                            updateFileStatusDisplay(this, statusSpan, deleteBtn, uploadLabel);
                        });
    
                        if (deleteBtn) {
                            deleteBtn.addEventListener('click', function() {
                                fileInput.value = '';
                                updateFileStatusDisplay(fileInput, statusSpan, deleteBtn, uploadLabel);
                            });
                        }
                    });
                }
                
                function displayImageThumbnail(fileInput) {
                    const previewId = fileInput.id + '_preview';
                    const previewBox = document.getElementById(previewId);
                    if (!previewBox) return;
    
                    const file = fileInput.files[0];
                    // ファイルが存在し、画像ファイルである場合
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            previewBox.innerHTML = `<img src="${e.target.result}" alt="プレビュー" style="max-width:100%; max-height:100%; object-fit:contain;">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        previewBox.innerHTML = '<span>プレビューなし</span>';
                    }
                }
    
                function updateFileStatusDisplay(fileInput, statusElement, deleteButton, uploadLabelElement) {
                    if (fileInput.files && fileInput.files.length > 0) {
                        statusElement.textContent = fileInput.files[0].name;
                        if (deleteButton) deleteButton.style.display = 'inline-block';
                        if (uploadLabelElement) uploadLabelElement.textContent = '変更';
                        localStorage.setItem(fileInput.id + '_filename', fileInput.files[0].name);
                    } else {
                        statusElement.textContent = statusElement.dataset.initialText || "選択されていません";
                        if (deleteButton) deleteButton.style.display = 'none';
                        if (uploadLabelElement) uploadLabelElement.textContent = uploadLabelElement.dataset.initialLabel || 'アップロード';
                        localStorage.removeItem(fileInput.id + '_filename');
                    }
                    // サムネイル表示関数を呼び出す
                    displayImageThumbnail(fileInput);
                }
                
                setupFileUpload();
    
                // --- START: Basic Info, Nationality, File Upload (partial) ---
                const nationalityRadios = document.querySelectorAll('input[name="nationality"]');
                const foreignNationalityDetails = document.getElementById('foreign_nationality_details');
                const countryNameSelect = document.getElementById('country_name');
                const countryNameOtherGroup = document.getElementById('country_name_other_group');
                const residenceStatusGroup = document.getElementById('residence_status_group');
                const foreignDocumentsContainer = document.getElementById('foreign_documents_container');
                
                function createForeignerDocumentUploadBox(id, name, labelText, icon = '📄') {
                    const docBox = document.createElement('div');
                    docBox.className = 'document-box';
                    docBox.id = `${id}_doc_box`;
                    docBox.style.flexBasis = 'calc(50% - 5px)';
                    
                    const pLabel = document.createElement('p');
                    const strongLabel = document.createElement('strong');
                    strongLabel.innerHTML = `${icon} ${labelText}`;
                    pLabel.appendChild(strongLabel);
                    docBox.appendChild(pLabel);
    
                    // サムネイル表示エリア
                    const previewBox = document.createElement('div');
                    previewBox.className = 'image-preview-box';
                    previewBox.id = `${id}_preview`;
                    previewBox.style.margin = '0 auto 10px';
                    previewBox.style.width = '150px';
                    previewBox.innerHTML = '<span>プレビューなし</span>';
                    docBox.appendChild(previewBox);
                    
                    const fileInput = document.createElement('input');
                    fileInput.type = 'file'; fileInput.id = id; fileInput.name = name; fileInput.style.display = 'none'; fileInput.accept = 'image/*,.pdf';
                    docBox.appendChild(fileInput);
    
                    const uploadLabel = document.createElement('label');
                    uploadLabel.htmlFor = id; uploadLabel.className = 'upload-button-placeholder'; uploadLabel.textContent = 'アップロード';
                    uploadLabel.style.marginTop = '5px'; uploadLabel.style.display = 'inline-block';
                    docBox.appendChild(uploadLabel);
                    
                    const statusContainer = document.createElement('div');
                    statusContainer.className = 'file-upload-status-container';
    
                    const pStatus = document.createElement('span');
                    pStatus.className = 'file-status'; pStatus.id = `${id}_file_status`; pStatus.textContent = '選択されていません';
                    pStatus.dataset.initialText = '選択されていません';
                    statusContainer.appendChild(pStatus);
    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.type = 'button';
                    deleteBtn.className = 'delete-file-btn';
                    deleteBtn.textContent = '削除';
                    deleteBtn.dataset.targetId = id;
                    deleteBtn.style.display = 'none';
                    statusContainer.appendChild(deleteBtn);
                    docBox.appendChild(statusContainer);
    
                    const storedFilename = localStorage.getItem(id + '_filename');
                    if (storedFilename) {
                        pStatus.textContent = storedFilename;
                        deleteBtn.style.display = 'inline-block';
                        uploadLabel.textContent = '変更';
                    }
    
                    fileInput.addEventListener('change', function() {
                        updateFileStatusDisplay(this, pStatus, deleteBtn, uploadLabel);
                    });
                    deleteBtn.addEventListener('click', function() {
                        fileInput.value = ''; 
                        updateFileStatusDisplay(fileInput, pStatus, deleteBtn, uploadLabel);
                    });
                    return docBox;
                }
    
                /// 国籍ラジオボタンの変更イベント処理
                function handleNationalityChange() {
                    const currentScrollY = window.scrollY;
                    const selectedNationality = document.querySelector('input[name="nationality"]:checked').value;
    
                    if (selectedNationality === 'foreign') {
                        foreignNationalityDetails.style.display = 'block';
                        residenceStatusGroup.style.display = 'block';
                        foreignDocumentsContainer.style.display = 'flex';
                        if (foreignDocumentsContainer.children.length === 0) {
                            foreignDocumentsContainer.appendChild(createForeignerDocumentUploadBox('residence_card_image', 'residence_card_image', '在留カード', '💳'));
                            foreignDocumentsContainer.appendChild(createForeignerDocumentUploadBox('passport_image', 'passport_image', 'パスポート', '🛂'));
                        }
                    } else {
                        foreignNationalityDetails.style.display = 'none';
                        if(countryNameSelect) countryNameSelect.value = '';
                        if(countryNameOtherGroup) countryNameOtherGroup.style.display = 'none';
                        residenceStatusGroup.style.display = 'none';
                        foreignDocumentsContainer.style.display = 'none';
                    }
                    
                    window.scrollTo(0, currentScrollY);
                }
    
                // 国名セレクトボックスの変更イベント処理
                function handleCountryChange() {
                    if (countryNameSelect.value === 'other') {
                        countryNameOtherGroup.style.display = 'block';
                    } else {
                        countryNameOtherGroup.style.display = 'none';
                    }
                }
                
                if (foreignNationalityDetails && residenceStatusGroup && foreignDocumentsContainer) {
                    nationalityRadios.forEach(radio => radio.addEventListener('change', handleNationalityChange));
                    if (countryNameSelect) countryNameSelect.addEventListener('change', handleCountryChange);
                    handleNationalityChange();
                    handleCountryChange();
                }
                // --- END: Basic Info, Nationality, File Upload (partial) ---
    
    
                // --- START: Contract Document Modal Logic ---
                const contractDocumentBoxes = document.querySelectorAll('.clickable-document');
                const allModals = document.querySelectorAll('.modal');
    
                function openModal(modalElement) { modalElement.style.display = 'flex'; }
                function closeModal(modalElement) {
                    modalElement.style.display = 'none';
                    if (modalElement.classList.contains('contract-agreement-modal')) {
                        const contractId = modalElement.id.replace('Modal', '');
                        if (localStorage.getItem(`${contractId}_status`) !== 'agreed') {
                            resetContractModalForms(modalElement, contractId);
                        }
                    }
                }
                function resetContractModalForms(modalElement, contractId) {
                    const agreeForm = modalElement.querySelector(`#${contractId}_agree_form`);
                    if (agreeForm) agreeForm.style.display = 'none';
                    const rejectForm = modalElement.querySelector(`#${contractId}_reject_form`);
                    if (rejectForm) rejectForm.style.display = 'none';
                    
                    ['signer_name', 'reject_reason'].forEach(field => {
                        const input = modalElement.querySelector(`#${contractId}_${field}`);
                        if (input) { input.value = ''; input.classList.remove('input-error'); }
                        const errorMsg = modalElement.querySelector(`#${contractId}_${field}_error`);
                        if (errorMsg) errorMsg.textContent = '';
                    });
                    const deliveryError = modalElement.querySelector(`#${contractId}_agree_delivery_error`);
                    if (deliveryError) deliveryError.textContent = '';
                    const deliveryCheckbox = modalElement.querySelector(`#${contractId}_agree_electronic_delivery`);
                    if(deliveryCheckbox) deliveryCheckbox.checked = true;
    
                    const preAgreementContent = modalElement.querySelector(`#${contractId}_pre_agreement_content`);
                    if(preAgreementContent) {
                        const buttonGroup = preAgreementContent.querySelector('.button-group');
                        if(buttonGroup) buttonGroup.style.display = 'flex';
                    }
                    updateModalFooter(modalElement, contractId, 'initial');
                }
    
                contractDocumentBoxes.forEach(box => {
                    box.addEventListener('click', function() {
                        const modalId = this.dataset.modalTarget;
                        const contractId = this.dataset.contractId;
                        const modalElement = document.querySelector(modalId);
                        if (modalElement) { 
                            loadContractModalState(modalElement, contractId);
                            openModal(modalElement); 
                            // ▼▼▼ 修正 ▼▼▼
                            // 雇用契約書モーダルの場合のみ、保険加入判定を実行
                            if (contractId === 'employmentContract') {
                                checkInsuranceEligibilityAndShowConfirmations();
                            }
                        }
                    });
                });
    
                document.querySelectorAll('.modal .close-button').forEach(button => {
                    button.addEventListener('click', function() { closeModal(this.closest('.modal')); });
                });
    
                window.addEventListener('click', function(event) {
                    allModals.forEach(modal => { if (event.target === modal) { closeModal(modal); } });
                });
    
                function loadContractModalState(modalElement, contractId) {
                    const contractStatus = localStorage.getItem(`${contractId}_status`) || 'pending';
                    const preAgreementContent = modalElement.querySelector(`#${contractId}_pre_agreement_content`);
                    const postAgreementContent = modalElement.querySelector(`#${contractId}_post_agreement_content`);
                    
                    const agreeForm = modalElement.querySelector(`#${contractId}_agree_form`);
                    const rejectForm = modalElement.querySelector(`#${contractId}_reject_form`);
                    const buttonGroup = preAgreementContent.querySelector('.button-group');
    
                    if(agreeForm) agreeForm.style.display = 'none';
                    if(rejectForm) rejectForm.style.display = 'none';
                    if(buttonGroup) buttonGroup.style.display = 'flex';
    
                    if (contractStatus === 'agreed') {
                        preAgreementContent.style.display = 'none';
                        postAgreementContent.style.display = 'flex';
                        updateModalFooter(modalElement, contractId, 'agreed');
    
                        const signerName = localStorage.getItem(`${contractId}_signer_name`);
                        const formattedDateTime = localStorage.getItem(`${contractId}_agreement_datetime`);
                        const detailsElement = document.getElementById(`${contractId}_agreement_details`);
    
                        if (detailsElement && signerName && formattedDateTime) {
                            detailsElement.innerHTML = `
                                <p style="margin: 5px 0;">合意日時: ${formattedDateTime}</p>
                                <p style="margin: 5px 0;">署名者名: ${signerName}</p>
                            `;
                        }
                    } else {
                        preAgreementContent.style.display = 'block'; 
                        postAgreementContent.style.display = 'none';
                        updateModalFooter(modalElement, contractId, 'initial'); 
    
                        const detailsElement = document.getElementById(`${contractId}_agreement_details`);
                        if (detailsElement) {
                            detailsElement.innerHTML = '';
                        }
                    }
                }
    
                function updateModalFooter(modalElement, contractId, state) {
                    const footer = modalElement.querySelector(`#${contractId}_modal_footer`);
                    footer.innerHTML = '';
    
                    if (state === 'agree_form') {
                        footer.innerHTML = `<button type="button" class="action-btn btn-secondary" data-action="cancel_agree" data-contract-id="${contractId}">キャンセル</button><button type="button" class="action-btn agree-btn" data-action="submit_agree" data-contract-id="${contractId}">合意する</button>`;
                    } else if (state === 'reject_form') {
                        footer.innerHTML = `<button type="button" class="action-btn btn-secondary" data-action="cancel_reject" data-contract-id="${contractId}">キャンセル</button><button type="button" class="action-btn reject-btn submit" data-action="submit_reject" data-contract-id="${contractId}">差し戻す</button>`;
                    } else if (state === 'agreed') {
                        footer.innerHTML = `<button type="button" class="action-btn btn-secondary" data-action="close" data-contract-id="${contractId}">閉じる</button>`;
                    } else {
                        footer.innerHTML = `<button type="button" class="action-btn btn-secondary" data-action="close" data-contract-id="${contractId}">閉じる</button>`;
                    }
                    footer.querySelectorAll('button').forEach(btn => { btn.addEventListener('click', handleModalFooterAction); });
                }
    
                function handleModalFooterAction(event) {
                    const action = event.target.dataset.action;
                    const contractId = event.target.dataset.contractId;
                    const modalElement = document.getElementById(`${contractId}Modal`);
                    
                    const agreeForm = modalElement.querySelector(`#${contractId}_agree_form`);
                    const rejectForm = modalElement.querySelector(`#${contractId}_reject_form`);
                    const buttonGroup = modalElement.querySelector(`#${contractId}_pre_agreement_content .button-group`);
    
                    if (action === 'cancel_agree' || action === 'cancel_reject') {
                        if(agreeForm) agreeForm.style.display = 'none';
                        if(rejectForm) rejectForm.style.display = 'none';
                        if(buttonGroup) buttonGroup.style.display = 'flex';
                        updateModalFooter(modalElement, contractId, 'initial');
                    } else if (action === 'submit_agree') { submitAgreement(modalElement, contractId);
                    } else if (action === 'submit_reject') { submitRejection(modalElement, contractId);
                    } else if (action === 'close') { closeModal(modalElement); }
                }
    
                modalEventListeners('add'); 
    
                function modalEventListeners(actionType) {
                    document.querySelectorAll('.contract-agreement-modal .agree-btn, .contract-agreement-modal .reject-btn').forEach(button => {
                        if (button.closest && button.closest(`#${button.dataset.contractId}_pre_agreement_content`)) {
                            const handler = (event) => handlePreAgreementActions(event, button.classList.contains('agree-btn') ? 'agree' : 'reject');
                            if (actionType === 'add') {
                                button.removeEventListener('click', handler);
                                button.addEventListener('click', handler);
                            } else {
                                button.removeEventListener('click', handler);
                            }
                        }
                    });
                }
                
                function handlePreAgreementActions(event, type) {
                    const contractId = event.target.dataset.contractId;
                    const modalElement = document.getElementById(`${contractId}Modal`);
                    const agreeForm = modalElement.querySelector(`#${contractId}_agree_form`);
                    const rejectForm = modalElement.querySelector(`#${contractId}_reject_form`);
                    const buttonGroup = modalElement.querySelector(`#${contractId}_pre_agreement_content .button-group`);
                    
                    buttonGroup.style.display = 'none';
    
                    if (type === 'agree') {
                        agreeForm.style.display = 'block'; rejectForm.style.display = 'none';
                        updateModalFooter(modalElement, contractId, 'agree_form');
                    } else if (type === 'reject') {
                        rejectForm.style.display = 'block'; agreeForm.style.display = 'none';
                        updateModalFooter(modalElement, contractId, 'reject_form');
                    }
                }
    
                function updateAgreeButtonState() {
                    const modal = document.getElementById('employmentContractModal');
                    if (!modal) return;
    
                    const agreeBtn = modal.querySelector('#employmentContract_pre_agreement_content .agree-btn');
                    const checkboxes = modal.querySelectorAll('#insurance_confirmation_section input[type="checkbox"]');
                    if (!agreeBtn || checkboxes.length === 0) return;
    
                    let allRequiredChecked = true;
                    checkboxes.forEach(cb => {
                        const parentDiv = cb.closest('div');
                        // 表示されているチェックボックスがチェックされているかを確認
                        if (parentDiv && parentDiv.style.display !== 'none' && !cb.checked) {
                            allRequiredChecked = false;
                        }
                    });
    
                    if (agreeBtn.disabled === !allRequiredChecked) return; // 状態が変わらないなら何もしない
    
                    agreeBtn.disabled = !allRequiredChecked;
                    agreeBtn.style.cursor = allRequiredChecked ? 'pointer' : 'not-allowed';
                    agreeBtn.style.opacity = allRequiredChecked ? '1' : '0.6';
                }
    
                function checkInsuranceEligibilityAndShowConfirmations() {
                    const modal = document.getElementById('employmentContractModal');
                    if (!modal) return;
                    
                    // UI要素を取得
                    const section = document.getElementById('insurance_confirmation_section');
                    const empCheckDiv = document.getElementById('employment_insurance_check_div');
                    const socCheckDiv = document.getElementById('social_insurance_check_div');
                    const empCheckbox = document.getElementById('confirm_employment_insurance');
                    const socCheckbox = document.getElementById('confirm_social_insurance');
    
                    // UIの状態をリセット
                    section.style.display = 'none';
                    empCheckDiv.style.display = 'none';
                    socCheckDiv.style.display = 'none';
                    empCheckbox.checked = false;
                    socCheckbox.checked = false;
    
                    const empType = document.getElementById('mock_employment_type').value;
    
                    if (empType !== 'サプラー') {
                        // サプラー以外は、社会保険・雇用保険に強制加入
                        empCheckDiv.style.display = 'block';
                        socCheckDiv.style.display = 'block';
                        section.style.display = 'block';
                        updateAgreeButtonState();
                        return; // 計算をスキップ
                    }
                    
                    // テーブルから契約情報を取得・解析するヘルパー関数
                    const getValueFromTable = (headerText) => {
                        const th = Array.from(modal.querySelectorAll('.contract-details-table th')).find(el => el.textContent.includes(headerText));
                        if (th && th.nextElementSibling) {
                            const text = th.nextElementSibling.textContent;
                            // "1,500 円"のような形式から数値のみを抽出
                            return parseFloat(text.replace(/[^0-9.]/g, '')) || 0;
                        }
                        return 0;
                    };
    
                    const contractHours = getValueFromTable('契約時間');
                    const contractDays = getValueFromTable('契約日数');
                    const hourlyWage = getValueFromTable('給与(時間給)');
    
                    if (contractHours === 0 || contractDays === 0 || hourlyWage === 0) {
                        updateAgreeButtonState(); // 数値が不正ならボタンの状態を初期化して終了
                        return;
                    }
    
                    // 加入条件を計算
                    const weeklyHours = (contractHours * contractDays * 12) / (365 / 7);
                    const monthlySalary = hourlyWage * contractHours * contractDays;
    
                    const isEligibleForEmployment = weeklyHours >= 20;
                    const isEligibleForSocial = isEligibleForEmployment && monthlySalary >= 88000;
    
                    let insuranceRequired = false;
                    if (isEligibleForSocial) {
                        // 社会保険・雇用保険の両方が対象
                        empCheckDiv.style.display = 'block';
                        socCheckDiv.style.display = 'block';
                        insuranceRequired = true;
                    } else if (isEligibleForEmployment) {
                        // 雇用保険のみ対象
                        empCheckDiv.style.display = 'block';
                        insuranceRequired = true;
                    }
    
                    if (insuranceRequired) {
                        section.style.display = 'block';
                    }
    
                    // ボタンの初期状態を設定
                    updateAgreeButtonState();
                }
    
                function submitAgreement(modalElement, contractId) {
                    const signerNameInput = modalElement.querySelector(`#${contractId}_signer_name`);
                    const deliveryCheckbox = modalElement.querySelector(`#${contractId}_agree_electronic_delivery`);
                    const signerError = modalElement.querySelector(`#${contractId}_signer_name_error`);
                    const deliveryError = modalElement.querySelector(`#${contractId}_agree_delivery_error`);
                    let isValid = true;
    
                    signerError.textContent = ''; deliveryError.textContent = ''; signerNameInput.classList.remove('input-error');
    
                    if (signerNameInput.value.trim() === '') {
                        signerError.textContent = '氏名を入力してください。'; signerNameInput.classList.add('input-error'); isValid = false;
                    }
                    if (!deliveryCheckbox.checked) {
                        deliveryError.textContent = '電子通知での受け取りに同意してください。'; isValid = false;
                    }
    
                    if (isValid) {
                        const agreementDateTime = new Date();
                        const formattedDateTime = `${agreementDateTime.getFullYear()}年${agreementDateTime.getMonth() + 1}月${agreementDateTime.getDate()}日 ${agreementDateTime.getHours()}:${agreementDateTime.getMinutes().toString().padStart(2, '0')}:${agreementDateTime.getSeconds().toString().padStart(2, '0')}`;
                        const signerName = signerNameInput.value.trim();
    
                        localStorage.setItem(`${contractId}_status`, 'agreed');
                        localStorage.setItem(`${contractId}_signer_name`, signerName);
                        localStorage.setItem(`${contractId}_agreement_datetime`, formattedDateTime);
    
                        const detailsElement = document.getElementById(`${contractId}_agreement_details`);
                        if (detailsElement) {
                            detailsElement.innerHTML = `
                                <p style="margin: 5px 0;">合意日時: ${formattedDateTime}</p>
                                <p style="margin: 5px 0;">署名者名: ${signerName}</p>
                            `;
                        }
    
                        const mainDocStatus = document.getElementById(`${contractId}Status`);
                        mainDocStatus.textContent = '（合意済）'; mainDocStatus.className = 'contract-status status-agreed';
                        document.getElementById(`${contractId}PostActions`).style.display = 'flex';
    
                        alert(`${modalElement.querySelector('h3').textContent} に合意しました。`);
                        loadContractModalState(modalElement, contractId);
                    }
                }
    
                function submitRejection(modalElement, contractId) {
                    const rejectReasonInput = modalElement.querySelector(`#${contractId}_reject_reason`);
                    const reasonError = modalElement.querySelector(`#${contractId}_reject_reason_error`);
                    let isValid = true;
                    reasonError.textContent = ''; rejectReasonInput.classList.remove('input-error');
    
                    if (rejectReasonInput.value.trim() === '') {
                        reasonError.textContent = '差し戻し理由を入力してください。'; rejectReasonInput.classList.add('input-error'); isValid = false;
                    }
    
                    if (isValid) {
                        localStorage.setItem(`${contractId}_status`, 'rejected');
                        localStorage.setItem(`${contractId}_reject_reason`, rejectReasonInput.value.trim());
                        localStorage.removeItem(`${contractId}_signer_name`);
                        localStorage.removeItem(`${contractId}_agreement_datetime`);
                        const detailsElement = document.getElementById(`${contractId}_agreement_details`);
                        if (detailsElement) {
                            detailsElement.innerHTML = '';
                        }
    
                        const mainDocStatus = document.getElementById(`${contractId}Status`);
                        mainDocStatus.textContent = '（差戻済）'; mainDocStatus.className = 'contract-status status-rejected';
                        document.getElementById(`${contractId}PostActions`).style.display = 'none';
                        
                        alert(`${modalElement.querySelector('h3').textContent} を差し戻しました。`);
                        closeModal(modalElement);
                    }
                }
    
                contractDocumentBoxes.forEach(box => {
                    const contractId = box.dataset.contractId;
                    const status = localStorage.getItem(`${contractId}_status`);
                    const mainDocStatus = document.getElementById(`${contractId}Status`);
                    const postActions = document.getElementById(`${contractId}PostActions`);
    
                    if (status === 'agreed') {
                        mainDocStatus.textContent = '（合意済）'; mainDocStatus.className = 'contract-status status-agreed'; postActions.style.display = 'flex';
                    } else if (status === 'rejected') {
                        mainDocStatus.textContent = '（差戻済）'; mainDocStatus.className = 'contract-status status-rejected'; postActions.style.display = 'none';
                    } else {
                        mainDocStatus.textContent = '（未合意）'; mainDocStatus.className = 'contract-status status-pending'; postActions.style.display = 'none';
                    }
                });
    
                function printContract(contractId) {
                    let title = '契約書';
                    if (contractId === 'employmentContract') title = '労働条件通知書_兼_雇用契約書';
                    else if (contractId === 'guaranteeContract') title = '誓約書';
    
                    const modal = document.getElementById(`${contractId}Modal`);
                    if (!modal) return;
                    const viewer = modal.querySelector('.contract-viewer');
                    if (!viewer) return;
    
                    const printWindow = window.open('', '_blank');
                    printWindow.document.write(`<html><head><title>${title}</title><style>
                        @page { size: A4; margin: 20mm; }
                        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; color: #333; font-size: 10pt; -webkit-print-color-adjust: exact; }
                        .contract-details-table { width: 100%; border-collapse: collapse; font-size: 9pt; }
                        .contract-details-table th, .contract-details-table td { border: 1px solid #ccc; padding: 5px; text-align: left; vertical-align: top; }
                        .contract-details-table th { background-color: #f8f9fa !important; font-weight: bold; width: 25%; }
                        h3 { text-align: center; font-size: 1.3em; margin-bottom: 1em;}
                        .agreement-details { text-align: right; margin-top: 25px; font-size: 12pt; line-height: 1.6; }
                        .additional-contract-info { page-break-before: always; }
                        .additional-contract-info h1 { font-size: 1.2em; }
                        .additional-contract-info h2 { font-size: 1.1em; }
                        .contract-text-content { font-size: 10pt; line-height: 1.7; }
                        .contract-text-content h4 { font-size: 1.1em; }
                        ol, ul { padding-left: 20px; }
                    </style></head><body>`);
                    printWindow.document.write(viewer.innerHTML);
                    printWindow.document.write('</body></html>');
                    printWindow.document.close();
                    setTimeout(() => { printWindow.focus(); printWindow.print(); printWindow.close(); }, 250);
                }
    
                async function downloadContractAsPdf(contractId) {
                    let filename = '契約書.pdf';
                    if (contractId === 'employmentContract') filename = '労働条件通知書_兼_雇用契約書.pdf';
                    else if (contractId === 'guaranteeContract') filename = '誓約書.pdf';
    
                    const viewer = document.querySelector(`#${contractId}Modal .contract-viewer`);
                    if (!viewer) return;
    
                    const clone = viewer.cloneNode(true);
                    clone.style.border = 'none';
                    clone.style.maxHeight = 'none'; clone.style.height = 'auto'; clone.style.overflow = 'visible';
                    const pageBreakElement = clone.querySelector('.additional-contract-info');
                    if (pageBreakElement) { pageBreakElement.style.pageBreakBefore = 'always'; }
                    clone.querySelectorAll('*').forEach(el => { const cs = window.getComputedStyle(el); if (cs.overflowY === 'auto' || cs.overflowY === 'scroll') el.style.overflowY = 'visible'; if (cs.maxHeight && cs.maxHeight !== 'none') el.style.maxHeight = 'none'; });
                    const A4_WIDTH_MM = 210, MARGINS_MM = { top:10, left:5, bottom:10, right:5 }, CONTENT_MM = A4_WIDTH_MM - MARGINS_MM.left - MARGINS_MM.right, SAFETY_MM = 2, EFFECTIVE_MM = CONTENT_MM - SAFETY_MM;
                    const DPI = 96, MM_PER_INCH = 25.4, contentPx = Math.floor(((EFFECTIVE_MM * 0.98) / MM_PER_INCH) * DPI);
                    clone.style.boxSizing = 'border-box'; clone.style.width = contentPx + 'px'; clone.style.maxWidth = contentPx + 'px'; clone.style.padding = '1px'; clone.style.backgroundColor = 'white'; clone.style.color = 'black';
                    clone.querySelectorAll('table').forEach(t => { t.style.tableLayout = 'fixed'; t.style.width = '100%'; t.style.boxSizing = 'border-box'; });
                    clone.querySelectorAll('th,td').forEach(c => { c.style.wordBreak = 'break-word'; c.style.boxSizing = 'border-box'; });
                    clone.style.breakInside = 'avoid'; clone.querySelectorAll('tr').forEach(tr => tr.style.breakInside = 'avoid'); clone.querySelectorAll('h1,h2,h3').forEach(h => h.style.breakAfter = 'avoid');
                    const renderRoot = document.getElementById('pdf-render-root');
                    renderRoot.appendChild(clone);
                    const opt = { margin: [MARGINS_MM.top, MARGINS_MM.left, MARGINS_MM.bottom, MARGINS_MM.right], filename, image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true, scrollX: 0, scrollY: 0 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }, pagebreak: { mode: ['css','legacy'] } };
                    try { await html2pdf().from(clone).set(opt).save(); } finally { if (renderRoot.contains(clone)) renderRoot.removeChild(clone); }
                }
                
                document.querySelectorAll('.print-contract-btn').forEach(btn => {
                    btn.addEventListener('click', (event) => {
                        const modal = event.target.closest('.modal'), docBox = event.target.closest('.document-box');
                        let contractId = null;
                        if (modal) contractId = modal.id.replace('Modal', '');
                        else if (docBox) contractId = docBox.dataset.contractId;
                        if (contractId) printContract(contractId);
                    });
                });
                document.querySelectorAll('.download-contract-btn').forEach(btn => {
                    btn.addEventListener('click', async (event) => {
                        const modal = event.target.closest('.modal'), docBox = event.target.closest('.document-box');
                        let contractId = null;
                        if (modal) contractId = modal.id.replace('Modal', '');
                        else if (docBox) contractId = docBox.dataset.contractId;
                        if (contractId) await downloadContractAsPdf(contractId);
                    });
                });
    
                ['signer_name', 'reject_reason'].forEach(fieldPrefix => {
                    ['employmentContract', 'guaranteeContract'].forEach(contractId => {
                        const input = document.getElementById(`${contractId}_${fieldPrefix}`), errorSpan = document.getElementById(`${contractId}_${fieldPrefix}_error`);
                        if (input && errorSpan) input.addEventListener('input', function() { if (this.classList.contains('input-error')) { this.classList.remove('input-error'); errorSpan.textContent = ''; } });
                    });
                });
                ['employmentContract', 'guaranteeContract'].forEach(contractId => {
                    const checkbox = document.getElementById(`${contractId}_agree_electronic_delivery`), errorSpan = document.getElementById(`${contractId}_agree_delivery_error`);
                    if(checkbox && errorSpan) checkbox.addEventListener('change', function(){ if(this.checked) errorSpan.textContent = ''; });
                });
                // --- END: Contract Document Modal Logic ---
    
                // --- START: Postal Code Auto-Address and Formatting Logic ---
                function formatPostalCode(inputElement) { let value = inputElement.value.replace(/[^0-9]/g, ""); if (value.length > 3) value = value.substring(0, 3) + "-" + value.substring(3); if (value.length > 8) value = value.substring(0, 8); inputElement.value = value; }
                async function fetchAddressFromPostalCode(postalCode, prefix) { const pc = postalCode.replace(/-/g, ''); if (pc.length !== 7) { alert('有効な郵便番号を7桁で入力してください。'); return; } try { const response = await fetch(`https://zipcloud.ibsnet.co.jp/api/search?zipcode=${pc}`); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); const data = await response.json(); if (data.status === 200 && data.results) { const result = data.results[0]; document.getElementById(`${prefix}prefecture`).value = result.address1 || ''; document.getElementById(`${prefix}city`).value = result.address2 || ''; document.getElementById(`${prefix}address_line1`).value = result.address3 || ''; } else { alert(`住所が見つかりませんでした: ${data.message || ''}`); } } catch (error) { console.error('住所検索エラー:', error); alert('住所の検索中にエラーが発生しました。'); } }
                const postalCodeInput = document.getElementById('postal_code'), searchAddressBtn = document.getElementById('search_address_btn'), emergencyPostalCodeInput = document.getElementById('emergency_postal_code'), searchEmergencyAddressBtn = document.getElementById('search_emergency_address_btn');
                if (postalCodeInput) { postalCodeInput.addEventListener('input', () => formatPostalCode(postalCodeInput)); postalCodeInput.addEventListener('blur', () => formatPostalCode(postalCodeInput)); }
                if (searchAddressBtn && postalCodeInput) searchAddressBtn.addEventListener('click', () => fetchAddressFromPostalCode(postalCodeInput.value, ''));
                if (emergencyPostalCodeInput) { emergencyPostalCodeInput.addEventListener('input', () => formatPostalCode(emergencyPostalCodeInput)); emergencyPostalCodeInput.addEventListener('blur', () => formatPostalCode(emergencyPostalCodeInput)); }
                if (searchEmergencyAddressBtn && emergencyPostalCodeInput) searchEmergencyAddressBtn.addEventListener('click', () => fetchAddressFromPostalCode(emergencyPostalCodeInput.value, 'emergency_'));
                // --- END: Postal Code Auto-Address and Formatting Logic ---
    
                // --- START: Bank Info ---
                toggleBankAccountForm();
                
                // 銀行名・支店名の検索機能
                const API_BASE_URL = 'https://bank.teraren.com', bankNameInput = document.getElementById('general_bank_name'), bankNameSuggestionsBox = document.getElementById('bank_name_suggestions'), bankCodeInput = document.getElementById('general_bank_code'), branchNameInput = document.getElementById('general_branch_name'), branchNameSuggestionsBox = document.getElementById('branch_name_suggestions'), branchCodeInput = document.getElementById('general_branch_code');
                async function fetchJson(url) { try { const response = await fetch(url, { headers: { 'Accept': 'application/json' } }); if (!response.ok) throw new Error(`HTTP error ${response.status}: ${response.statusText}`); const contentType = response.headers.get("content-type"); if (!contentType || !contentType.includes("application/json")) { const text = await response.text(); throw new TypeError(`Received non-JSON response: ${text.substring(0, 100)}`); } return await response.json(); } catch (error) { console.error('API fetch error:', error); throw error; } }
                function showSuggestions(inputElement, suggestionBox, items, itemKey = 'name') { suggestionBox.innerHTML = ''; if (items && items.length > 0) { items.forEach(item => { const div = document.createElement('div'); div.textContent = item[itemKey]; div.addEventListener('mousedown', () => { inputElement.value = item[itemKey]; suggestionBox.style.display = 'none'; suggestionBox.innerHTML = ''; if (inputElement.id === 'general_bank_name') { bankNameInput.dataset.bankCode = item.code || ''; bankCodeInput.value = item.code || ''; branchNameInput.value = ''; branchCodeInput.value = ''; branchNameInput.focus(); } else if (inputElement.id === 'general_branch_name') { branchCodeInput.value = item.code || ''; } }); suggestionBox.appendChild(div); }); suggestionBox.style.display = 'block'; } else { suggestionBox.style.display = 'none'; } }
                if (bankNameInput && bankNameSuggestionsBox) { bankNameInput.addEventListener('input', async function () { const query = this.value.trim(); this.dataset.bankCode = ''; bankCodeInput.value = ''; branchNameInput.value = ''; branchCodeInput.value = ''; if (query.length < 1) { bankNameSuggestionsBox.style.display = 'none'; return; } try { const data = await fetchJson(`${API_BASE_URL}/banks/search.json?name=${encodeURIComponent(query)}`); const filteredBanks = Array.isArray(data) ? data.filter(bank => bank.code !== '9900') : []; showSuggestions(this, bankNameSuggestionsBox, filteredBanks, 'name'); } catch (err) { bankNameSuggestionsBox.style.display = 'none'; } }); bankNameInput.addEventListener('blur', async function () { setTimeout(() => { if (!bankNameSuggestionsBox.contains(document.activeElement)) bankNameSuggestionsBox.style.display = 'none'; }, 200); if (bankCodeInput.value) return; const query = this.value.trim(); if (query.length < 1) return; try { const data = await fetchJson(`${API_BASE_URL}/banks/search.json?name=${encodeURIComponent(query)}`); const exactMatch = Array.isArray(data) ? data.find(bank => bank.name === query && bank.code !== '9900') : null; if (exactMatch) { this.dataset.bankCode = exactMatch.code; bankCodeInput.value = exactMatch.code; } } catch (err) { console.error('銀行の完全一致検索に失敗:', err); } }); }
                if (branchNameInput && branchNameSuggestionsBox && bankNameInput) { branchNameInput.addEventListener('input', async function () { const bankCode = bankNameInput.dataset.bankCode || '', query = this.value.trim(); branchCodeInput.value = ''; if (!bankCode || query.length < 1) { branchNameSuggestionsBox.style.display = 'none'; return; } try { const data = await fetchJson(`${API_BASE_URL}/banks/${bankCode}/branches/search.json?name=${encodeURIComponent(query)}`); showSuggestions(this, branchNameSuggestionsBox, Array.isArray(data) ? data : [], 'name'); } catch (err) { branchNameSuggestionsBox.style.display = 'none'; } }); branchNameInput.addEventListener('blur', async function () { setTimeout(() => { if (!branchNameSuggestionsBox.contains(document.activeElement)) branchNameSuggestionsBox.style.display = 'none'; }, 200); if (branchCodeInput.value) return; const bankCode = bankNameInput.dataset.bankCode || '', query = this.value.trim(); if (!bankCode || query.length < 1) return; try { const data = await fetchJson(`${API_BASE_URL}/banks/${bankCode}/branches/search.json?name=${encodeURIComponent(query)}`); const exactMatch = Array.isArray(data) ? data.find(branch => branch.name === query) : null; if (exactMatch) branchCodeInput.value = exactMatch.code; } catch (err) { console.error('支店の完全一致検索に失敗:', err); } }); }
                
                // 「次へ」ボタンクリック時の処理
                const saveAndNextButton = document.getElementById('saveAndNext'); 
                if (saveAndNextButton) { 
                    saveAndNextButton.addEventListener('click', function(event) { 
                        const isGeneralBank = document.querySelector('input[name="bank_type"][value="general"]').checked; 
                        if (isGeneralBank) { 
                            const bankCode = document.getElementById('general_bank_code').value.trim(), branchCode = document.getElementById('general_branch_code').value.trim(); 
                            if (!bankCode || !branchCode) { 
                                alert('金融機関コードと支店コードの両方を入力してください。\n銀行名・支店名を入力し、候補から選択するか、正確な名称を入力して確定してください。'); 
                                event.preventDefault(); 
                                return; 
                            }
                        }
    
                        // 家族情報の保存ロジック
                        const familyForms = document.querySelectorAll('#family_entries_container .family-form-container');
                        const familyData = [];
                        familyForms.forEach((form, index) => {
                            const newIndex = index + 1;
                            const lastName = form.querySelector(`input[name="family_last_name_${newIndex}"]`)?.value.trim();
                            const firstName = form.querySelector(`input[name="family_first_name_${newIndex}"]`)?.value.trim();
                            
                            if (lastName || firstName) {
                                familyData.push({
                                    lastName: lastName,
                                    firstName: firstName,
                                    fullName: `${lastName || ''} ${firstName || ''}`.trim(),
                                    lastNameKana: form.querySelector(`input[name="family_last_name_kana_${newIndex}"]`)?.value.trim(),
                                    firstNameKana: form.querySelector(`input[name="family_first_name_kana_${newIndex}"]`)?.value.trim(),
                                    dob: form.querySelector(`input[name="family_dob_${newIndex}"]`)?.value,
                                    relationship: form.querySelector(`select[name="family_relationship_${newIndex}"]`)?.value,
                                    gender: form.querySelector(`input[name="family_gender_${newIndex}"]:checked`)?.value || null,
                                    residence: form.querySelector(`input[name="family_residence_${newIndex}"]:checked`)?.value || null,
                                    remarks: form.querySelector(`input[name="family_remarks_${newIndex}"]`)?.value.trim()
                                });
                            }
                        });
                        localStorage.setItem('family_data', JSON.stringify(familyData));
                        
                        localStorage.setItem('birth_date', document.getElementById('birth_date').value); 
                        
                        localStorage.setItem('prefecture', document.getElementById('prefecture').value); 
                        localStorage.setItem('city', document.getElementById('city').value); 
                        localStorage.setItem('address_line1', document.getElementById('address_line1').value); 
                    }); 
                }
                // --- END: Bank Info ---
    
                // ▼▼▼ START: 家族状況セクションのUI/UX改善版ロジック（氏名・フリガナ分割対応） ▼▼▼
                const familyContainer = document.getElementById('family_entries_container');
    
                const relationshipOptions = ['夫', '妻', '長男', '長女', '次男', '次女', '三男', '三女', '四男', '四女', '五男', '五女', '六男', '六女', '父', '母', '義父', '義母', '祖父', '祖母', '孫', '兄', '姉', '弟', '妹', '義兄', '義姉', '義弟', '義妹', '伯父', '伯母', '叔父', '叔母', '甥', '姪', '里子', '婿', '嫁', '子'];
    
                function updateFamilyButtons() {
                    const forms = familyContainer.querySelectorAll('.family-form-container');
                    forms.forEach((form, index) => {
                        let buttonCell = form.querySelector('.button-cell');
                        if (!buttonCell) return;
                        buttonCell.innerHTML = '';
    
                        if (forms.length > 1) {
                            const deleteButton = document.createElement('button');
                            deleteButton.type = 'button';
                            deleteButton.className = 'delete-family-btn';
                            deleteButton.textContent = 'この家族情報を削除';
                            buttonCell.appendChild(deleteButton);
                        }
    
                        if (index === forms.length - 1) {
                            const addButton = document.createElement('button');
                            addButton.type = 'button';
                            addButton.className = 'add-button';
                            addButton.textContent = '＋家族情報を追加する';
                            addButton.addEventListener('click', addFamilyEntry);
                            buttonCell.appendChild(addButton);
                        }
                    });
                }
                
                function renumberFamilyEntries() {
                    familyContainer.querySelectorAll('.family-form-container').forEach((form, index) => {
                        const newIndex = index + 1;
                        form.querySelector('.dependent-block-header').textContent = `家族 ${newIndex}`;
                        form.querySelectorAll('input, select').forEach(input => {
                            const oldId = input.id;
                            const baseName = input.name ? input.name.replace(/_\d+$/, '') : '';
                            const baseId = input.id ? input.id.replace(/_\d+$/, '') : '';
                            
                            if (baseName) input.name = `${baseName}_${newIndex}`;
                            if (baseId) input.id = `${baseId}_${newIndex}`;
                            
                            const label = form.querySelector(`label[for="${oldId}"]`);
                            if(label) label.htmlFor = input.id;
                        });
                    });
                }
    
                function createFamilyEntry(index) {
                    const container = document.createElement('div');
                    container.className = 'family-form-container';
                    const relationshipSelectHTML = relationshipOptions.map(r => `<option value="${r}">${r}</option>`).join('');
    
                    container.innerHTML = `
                        <div class="dependent-form-container" style="margin-bottom: 0;">
                            <table class="dependent-table" style="margin-bottom: 0;">
                                <tbody>
                                    <tr><td colspan="2" class="dependent-block-header">家族 ${index}</td></tr>
                                    <tr>
                                        <th>氏名</th>
                                        <td>
                                            <div class="inline-fields" style="gap: 8px; flex-wrap: nowrap;">
                                                <input type="text" name="family_last_name_${index}" placeholder="姓" style="flex: 1 1 50%;">
                                                <input type="text" name="family_first_name_${index}" placeholder="名" style="flex: 1 1 50%;">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>フリガナ</th>
                                        <td>
                                            <div class="inline-fields" style="gap: 8px; flex-wrap: nowrap;">
                                                <input type="text" name="family_last_name_kana_${index}" placeholder="セイ" style="flex: 1 1 50%;">
                                                <input type="text" name="family_first_name_kana_${index}" placeholder="メイ" style="flex: 1 1 50%;">
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>生年月日</th>
                                        <td><input type="date" name="family_dob_${index}"></td>
                                    </tr>
                                    <tr>
                                        <th>続柄</th>
                                        <td>
                                            <select name="family_relationship_${index}">
                                                <option value="">選択してください</option>
                                                ${relationshipSelectHTML}
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>性別</th>
                                        <td>
                                            <div class="radio-group">
                                                <label><input type="radio" name="family_gender_${index}" value="male"> 男</label>
                                                <label><input type="radio" name="family_gender_${index}" value="female"> 女</label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>住まい</th>
                                        <td>
                                            <div class="radio-group">
                                                <label><input type="radio" name="family_residence_${index}" value="same"> 同居</label>
                                                <label><input type="radio" name="family_residence_${index}" value="different"> 別居</label>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th>備考</th>
                                        <td><input type="text" name="family_remarks_${index}"></td>
                                    </tr>
                                    <tr>
                                        <td colspan="2" class="button-cell"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>`;
                    return container;
                }
    
                function addFamilyEntry() {
                    const newIndex = familyContainer.children.length + 1;
                    familyContainer.appendChild(createFamilyEntry(newIndex));
                    updateFamilyButtons();
                }
                
                if(familyContainer) {
                    familyContainer.addEventListener('click', e => {
                        if (e.target.classList.contains('delete-family-btn')) {
                            e.target.closest('.family-form-container').remove();
                            renumberFamilyEntries();
                            updateFamilyButtons();
                        }
                    });
                }
    
                addFamilyEntry();
                // ▲▲▲ END: 家族状況セクションのロジック ▲▲▲

                // ▼▼▼ ここから追加 ▼▼▼
                function updateContractBasedOnMockInputs() {
                    const empType = document.getElementById('mock_employment_type').value;
                    const hours = document.getElementById('mock_contract_hours').value;
                    const days = document.getElementById('mock_contract_days').value;
                    const salary = document.getElementById('mock_salary').value;
                    const note = document.getElementById('hourly_wage_note');
    
                    const modal = document.getElementById('employmentContractModal');
                    if (!modal) return;
    
                    // テーブルのセルを更新するヘルパー関数
                    const updateCell = (headerText, value) => {
                        const th = Array.from(modal.querySelectorAll('.contract-details-table th')).find(el => el.textContent.includes(headerText));
                        if (th && th.nextElementSibling) {
                            th.nextElementSibling.textContent = value;
                        }
                    };
                    
                    // 雇用区分を常に更新
                    updateCell('雇用区分', `${empType}《${empType}》`);
    
                    if (empType === 'サプラー') {
                        note.style.display = 'block';
                        // サプラーの場合、入力値を契約書に反映
                        updateCell('契約時間', `${hours} 時間`);
                        updateCell('契約日数', `${days} 日`);
                        updateCell('給与(時間給)', `${Number(salary).toLocaleString()} 円`);
                    } else {
                        note.style.display = 'none';
                        // サプラー以外の場合、給与は月給として扱うが、契約書の給与欄は「時間給」のため、ここでは更新しない
                        // (契約書のフォーマットが雇用区分によって変わらないという前提)
                    }

                    // モーダルが開いている場合は、保険加入判定を再実行
                    if(modal.style.display === 'flex') {
                        checkInsuranceEligibilityAndShowConfirmations();
                    }
                }

                const mockInputs = ['mock_employment_type', 'mock_contract_hours', 'mock_contract_days', 'mock_salary'];
                mockInputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', updateContractBasedOnMockInputs);
                    }
                });

                // 初期表示のために一度呼び出す
                updateContractBasedOnMockInputs();

                // 雇用契約書モーダル内のチェックボックス変更イベントを監視
                const employmentContractModal = document.getElementById('employmentContractModal');
                if (employmentContractModal) {
                    employmentContractModal.addEventListener('change', (event) => {
                        // イベント発生元が保険確認チェックボックスの場合のみボタン状態を更新
                        if (event.target.name === 'confirm_insurance') {
                            updateAgreeButtonState();
                        }
                    });
                }
                // ▲▲▲ 追加ここまで ▲▲▲
    
                // --- START: Devtool buttons ---
                const devFillFormBtn = document.getElementById('dev_fill_form_btn'), devResetFormBtn = document.getElementById('dev_reset_form_btn'), devClearStorageBtn = document.getElementById('dev_clear_storage_btn');
                if(devFillFormBtn) { devFillFormBtn.addEventListener('click', () => { document.getElementById('last_name').value = '開発'; document.getElementById('first_name').value = '花子'; document.getElementById('last_name_kana').value = 'カイハツ'; document.getElementById('first_name_kana').value = 'ハナコ'; document.getElementById('gender').value = 'female'; document.getElementById('birth_date').value = '1995-05-15'; document.getElementById('mobile_phone_number').value = '090-9876-5432'; document.getElementById('email').value = 'hanako.dev@example.com'; document.getElementById('postal_code').value = '150-0002'; fetchAddressFromPostalCode('150-0002', '').then(() => { document.getElementById('address_line2').value = 'テストアパート303'; document.getElementById('address_kana').value = 'トウキョウトシブヤクシブヤ'; }); document.getElementById('emergency_last_name').value = '開発'; document.getElementById('emergency_first_name').value = '一郎'; document.getElementById('emergency_relationship').value = 'sibling'; document.querySelector('input[name="bank_type"][value="general"]').click(); document.getElementById('general_bank_name').value = '三菱UFJ銀行'; document.getElementById('general_bank_name').dispatchEvent(new Event('blur')); document.getElementById('general_account_number').value = '1234567'; document.getElementById('general_account_holder_name').value = 'カイハツ ハナコ'; console.log("テストデータがページ1の項目に入力されました。"); }); }
                if(devResetFormBtn) { devResetFormBtn.addEventListener('click', () => { document.getElementById('onboardingFormPage1').reset(); document.querySelectorAll('.file-status').forEach(el => { el.textContent = el.dataset.initialText || "選択されていません"; }); if(foreignDocumentsContainer) foreignDocumentsContainer.innerHTML = ''; if(fileInfoContainer) fileInfoContainer.innerHTML = ''; toggleBankAccountForm(); console.log("ページ1のフォーム入力がリセットされました。"); }); }
                if(devClearStorageBtn) { devClearStorageBtn.addEventListener('click', () => { localStorage.clear(); alert('LocalStorageがクリアされました。ページを再読み込みします。'); window.location.reload(); }); }
                // --- END: Devtool buttons ---
            });
        </script>
        <div id="pdf-render-root" style="position:fixed; inset:0 auto auto 0; width:794px; z-index:-1; opacity:0; pointer-events:none;"></div>
    </body>
</html>
